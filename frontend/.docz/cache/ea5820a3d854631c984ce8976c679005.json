{"remainingRequest":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js?{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\",[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-preset-docz/dist/index.js\",{\"flow\":true,\"typescript\":false,\"parseProps\":true}]],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/docz-utils/lib/named-asset-import.js\",{\"loaderMap\":{\"svg\":{\"ReactComponent\":\"@svgr/webpack?-prettier,-svgo![path]\"}}}],\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/react-hot-loader/babel.js\"],\"env\":{\"production\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"transform-react-remove-prop-types\",\"lodash\"]},\"test\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"@babel/plugin-transform-modules-commonjs\",[\"module-resolver\",{\"alias\":{\"scripts\":\"./scripts\",\"actions\":\"./scripts/actions\",\"utils\":\"./scripts/utils\",\"reducers\":\"./scripts/reducers\",\"store\":\"./scripts/store\",\"components\":\"./scripts/components\",\"containers\":\"./scripts/containers\",\"constants\":\"./scripts/constants\",\"router\":\"./scripts/router\",\"react-components\":\"./scripts/react-components\",\"named-maps\":\"./scripts/named-maps\"}}]]}},\"babelrc\":false,\"cacheCompression\":false,\"compact\":false}!/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/components/tool/nodesTitles.component.js","dependencies":[{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/components/tool/nodesTitles.component.js","mtime":1548345115467},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/.babelrc","mtime":1548840716937},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nimport formatValue from 'utils/formatValue';\nimport NodeTitleTemplate from 'templates/tool/nodeTitle.ejs';\nimport 'scripts/react-components/tool/tool-search/node-title-group/node-title-group.scss';\nimport 'styles/components/tool/nodes-clear.scss';\nimport Tooltip from 'components/shared/info-tooltip.component';\n\nvar _default =\n/*#__PURE__*/\nfunction () {\n  function _default() {\n    _classCallCheck(this, _default);\n  }\n\n  _createClass(_default, [{\n    key: \"onCreated\",\n    value: function onCreated() {\n      this.el = document.querySelector('.js-nodes-titles');\n      this.container = this.el.querySelector('.js-nodes-titles-container');\n      this.clear = this.el.querySelector('.js-nodes-titles-clear');\n      this.tooltip = new Tooltip('.js-node-tooltip');\n      this._onNodeTitleClickBound = this._onNodeTitleClick.bind(this);\n      this._onNodeTitleCloseClickBound = this._onNodeTitleCloseClick.bind(this);\n      this.clear.addEventListener('click', this.callbacks.onClearClick);\n    }\n  }, {\n    key: \"selectNodes\",\n    value: function selectNodes(data) {\n      this._update(true, data.nodesData, data.recolorGroups, data.currentQuant, data.selectedYears, data.selectedContextId);\n    }\n  }, {\n    key: \"highlightNode\",\n    value: function highlightNode(_ref) {\n      var isHighlight = _ref.isHighlight,\n          nodesData = _ref.nodesData,\n          recolorGroups = _ref.recolorGroups,\n          coordinates = _ref.coordinates,\n          currentQuant = _ref.currentQuant,\n          selectedYears = _ref.selectedYears,\n          selectedContextId = _ref.selectedContextId;\n      this.tooltip.hide();\n\n      if (nodesData === undefined || !nodesData.length) {\n        return;\n      } // if we have coordinates, request came from hover on map, so we have a tooltip and don't need to show pill\n      // else show pill for sankey node\n\n\n      if (coordinates !== undefined) {\n        this._showTooltip(nodesData, coordinates, currentQuant);\n      } else {\n        this.el.classList.remove('is-hidden');\n\n        this._update(!isHighlight, nodesData, recolorGroups, currentQuant, selectedYears, selectedContextId);\n      }\n    }\n  }, {\n    key: \"_update\",\n    value: function _update(isSelect, nodesData) {\n      var _this = this;\n\n      var recolorGroups = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var currentQuant = arguments.length > 3 ? arguments[3] : undefined;\n      var selectedYears = arguments.length > 4 ? arguments[4] : undefined;\n      var selectedContextId = arguments.length > 5 ? arguments[5] : undefined;\n      this.clear.classList.toggle('is-hidden', !isSelect);\n      Array.prototype.slice.call(document.querySelectorAll('.js-node-title.-link'), 0).forEach(function (nodeTitle) {\n        nodeTitle.removeEventListener('click', _this._onNodeTitleClick);\n      });\n      Array.prototype.slice.call(document.querySelectorAll('.js-node-close'), 0).forEach(function (closeButton) {\n        closeButton.removeEventListener('click', _this._onNodeTitleCloseClick);\n      });\n      var templateData = {\n        contextId: selectedContextId,\n        year: selectedYears ? selectedYears[0] : null,\n        nodes: nodesData.map(function (node) {\n          var renderedQuant;\n\n          if (node.quant !== undefined) {\n            renderedQuant = {\n              valueNice: formatValue(node.quant, currentQuant.name),\n              unit: currentQuant.unit,\n              name: currentQuant.name\n            };\n          }\n\n          var renderedMetas;\n\n          if (node.selectedMetas !== undefined) {\n            renderedMetas = node.selectedMetas.map(function (originalMeta) {\n              return {\n                valueNice: formatValue(originalMeta.rawValue, originalMeta.name),\n                name: originalMeta.name,\n                unit: originalMeta.unit\n              };\n            });\n          }\n\n          return Object.assign({}, node, {\n            hasLink: node.isUnknown !== true && node.isDomesticConsumption !== true && node.profileType !== undefined && node.profileType !== null,\n            selectedMetas: renderedMetas,\n            renderedQuant: renderedQuant\n          });\n        }),\n        isSelect: isSelect || nodesData.length > 1,\n        recolorGroups: recolorGroups\n      };\n      this.container.innerHTML = NodeTitleTemplate(templateData);\n      Array.prototype.slice.call(document.querySelectorAll('.js-node-title.-link'), 0).forEach(function (nodeTitle) {\n        nodeTitle.addEventListener('click', _this._onNodeTitleClickBound);\n      });\n      Array.prototype.slice.call(document.querySelectorAll('.js-node-close'), 0).forEach(function (closeButton) {\n        closeButton.addEventListener('click', _this._onNodeTitleCloseClickBound);\n      });\n    }\n  }, {\n    key: \"_onNodeTitleClick\",\n    value: function _onNodeTitleClick(e) {\n      this.callbacks.onProfileLinkClicked(parseInt(e.currentTarget.dataset.nodeId, 10), parseInt(e.currentTarget.dataset.year, 10), parseInt(e.currentTarget.dataset.contextId, 10));\n    }\n  }, {\n    key: \"_onNodeTitleCloseClick\",\n    value: function _onNodeTitleCloseClick(e) {\n      e.stopPropagation();\n      this.callbacks.onCloseNodeClicked(parseInt(e.currentTarget.dataset.nodeId, 10));\n    }\n  }, {\n    key: \"_showTooltip\",\n    value: function _showTooltip(nodesData, coordinates, currentQuant) {\n      var node = nodesData[0];\n\n      if (node.selectedMetas === undefined || !coordinates) {\n        return;\n      }\n\n      var values = []; // map metas might not be loaded yet\n\n      if (node.selectedMetas !== undefined) {\n        values = node.selectedMetas.map(function (meta) {\n          return {\n            title: meta.name,\n            unit: meta.unit,\n            value: formatValue(meta.rawValue, meta.name)\n          };\n        }).concat(values);\n      } // if node is visible in sankey, quant is available\n\n\n      if (node.quant !== undefined) {\n        values.push({\n          title: currentQuant.name,\n          unit: currentQuant.unit,\n          value: formatValue(node.quant, currentQuant.name)\n        });\n      }\n\n      this.tooltip.show(coordinates.pageX, coordinates.pageY, node.name, values);\n    }\n  }]);\n\n  return _default;\n}();\n\nexport { _default as default };\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(_classCallCheck, \"_classCallCheck\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/components/tool/nodesTitles.component.js\");\n  reactHotLoader.register(_defineProperties, \"_defineProperties\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/components/tool/nodesTitles.component.js\");\n  reactHotLoader.register(_createClass, \"_createClass\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/components/tool/nodesTitles.component.js\");\n  reactHotLoader.register(_default, \"_default\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/components/tool/nodesTitles.component.js\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/components/tool/nodesTitles.component.js"],"names":["document","data","isHighlight","nodesData","recolorGroups","coordinates","currentQuant","selectedYears","selectedContextId","isSelect","Array","nodeTitle","closeButton","templateData","contextId","year","nodes","node","renderedQuant","valueNice","formatValue","unit","name","renderedMetas","originalMeta","hasLink","selectedMetas","NodeTitleTemplate","e","parseInt","values","title","meta","value"],"mappings":"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","sourcesContent":["import formatValue from 'utils/formatValue';\nimport NodeTitleTemplate from 'templates/tool/nodeTitle.ejs';\nimport 'scripts/react-components/tool/tool-search/node-title-group/node-title-group.scss';\nimport 'styles/components/tool/nodes-clear.scss';\nimport Tooltip from 'components/shared/info-tooltip.component';\n\nexport default class {\n  onCreated() {\n    this.el = document.querySelector('.js-nodes-titles');\n    this.container = this.el.querySelector('.js-nodes-titles-container');\n    this.clear = this.el.querySelector('.js-nodes-titles-clear');\n    this.tooltip = new Tooltip('.js-node-tooltip');\n\n    this._onNodeTitleClickBound = this._onNodeTitleClick.bind(this);\n    this._onNodeTitleCloseClickBound = this._onNodeTitleCloseClick.bind(this);\n\n    this.clear.addEventListener('click', this.callbacks.onClearClick);\n  }\n\n  selectNodes(data) {\n    this._update(\n      true,\n      data.nodesData,\n      data.recolorGroups,\n      data.currentQuant,\n      data.selectedYears,\n      data.selectedContextId\n    );\n  }\n\n  highlightNode({\n    isHighlight,\n    nodesData,\n    recolorGroups,\n    coordinates,\n    currentQuant,\n    selectedYears,\n    selectedContextId\n  }) {\n    this.tooltip.hide();\n    if (nodesData === undefined || !nodesData.length) {\n      return;\n    }\n    // if we have coordinates, request came from hover on map, so we have a tooltip and don't need to show pill\n    // else show pill for sankey node\n    if (coordinates !== undefined) {\n      this._showTooltip(nodesData, coordinates, currentQuant);\n    } else {\n      this.el.classList.remove('is-hidden');\n      this._update(\n        !isHighlight,\n        nodesData,\n        recolorGroups,\n        currentQuant,\n        selectedYears,\n        selectedContextId\n      );\n    }\n  }\n\n  _update(\n    isSelect,\n    nodesData,\n    recolorGroups = null,\n    currentQuant,\n    selectedYears,\n    selectedContextId\n  ) {\n    this.clear.classList.toggle('is-hidden', !isSelect);\n\n    Array.prototype.slice\n      .call(document.querySelectorAll('.js-node-title.-link'), 0)\n      .forEach(nodeTitle => {\n        nodeTitle.removeEventListener('click', this._onNodeTitleClick);\n      });\n\n    Array.prototype.slice\n      .call(document.querySelectorAll('.js-node-close'), 0)\n      .forEach(closeButton => {\n        closeButton.removeEventListener('click', this._onNodeTitleCloseClick);\n      });\n\n    const templateData = {\n      contextId: selectedContextId,\n      year: selectedYears ? selectedYears[0] : null,\n      nodes: nodesData.map(node => {\n        let renderedQuant;\n        if (node.quant !== undefined) {\n          renderedQuant = {\n            valueNice: formatValue(node.quant, currentQuant.name),\n            unit: currentQuant.unit,\n            name: currentQuant.name\n          };\n        }\n\n        let renderedMetas;\n        if (node.selectedMetas !== undefined) {\n          renderedMetas = node.selectedMetas.map(originalMeta => ({\n            valueNice: formatValue(originalMeta.rawValue, originalMeta.name),\n            name: originalMeta.name,\n            unit: originalMeta.unit\n          }));\n        }\n\n        return Object.assign({}, node, {\n          hasLink:\n            node.isUnknown !== true &&\n            node.isDomesticConsumption !== true &&\n            node.profileType !== undefined &&\n            node.profileType !== null,\n          selectedMetas: renderedMetas,\n          renderedQuant\n        });\n      }),\n      isSelect: isSelect || nodesData.length > 1,\n      recolorGroups\n    };\n\n    this.container.innerHTML = NodeTitleTemplate(templateData);\n\n    Array.prototype.slice\n      .call(document.querySelectorAll('.js-node-title.-link'), 0)\n      .forEach(nodeTitle => {\n        nodeTitle.addEventListener('click', this._onNodeTitleClickBound);\n      });\n\n    Array.prototype.slice\n      .call(document.querySelectorAll('.js-node-close'), 0)\n      .forEach(closeButton => {\n        closeButton.addEventListener('click', this._onNodeTitleCloseClickBound);\n      });\n  }\n\n  _onNodeTitleClick(e) {\n    this.callbacks.onProfileLinkClicked(\n      parseInt(e.currentTarget.dataset.nodeId, 10),\n      parseInt(e.currentTarget.dataset.year, 10),\n      parseInt(e.currentTarget.dataset.contextId, 10)\n    );\n  }\n\n  _onNodeTitleCloseClick(e) {\n    e.stopPropagation();\n    this.callbacks.onCloseNodeClicked(parseInt(e.currentTarget.dataset.nodeId, 10));\n  }\n\n  _showTooltip(nodesData, coordinates, currentQuant) {\n    const node = nodesData[0];\n\n    if (node.selectedMetas === undefined || !coordinates) {\n      return;\n    }\n\n    let values = [];\n\n    // map metas might not be loaded yet\n    if (node.selectedMetas !== undefined) {\n      values = node.selectedMetas\n        .map(meta => ({\n          title: meta.name,\n          unit: meta.unit,\n          value: formatValue(meta.rawValue, meta.name)\n        }))\n        .concat(values);\n    }\n\n    // if node is visible in sankey, quant is available\n    if (node.quant !== undefined) {\n      values.push({\n        title: currentQuant.name,\n        unit: currentQuant.unit,\n        value: formatValue(node.quant, currentQuant.name)\n      });\n    }\n\n    this.tooltip.show(coordinates.pageX, coordinates.pageY, node.name, values);\n  }\n}\n"]}]}