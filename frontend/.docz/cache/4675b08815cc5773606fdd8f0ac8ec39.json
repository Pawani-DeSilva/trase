{"remainingRequest":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js?{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\",[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-preset-docz/dist/index.js\",{\"flow\":true,\"typescript\":false,\"parseProps\":true}]],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/docz-utils/lib/named-asset-import.js\",{\"loaderMap\":{\"svg\":{\"ReactComponent\":\"@svgr/webpack?-prettier,-svgo![path]\"}}}],\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/react-hot-loader/babel.js\"],\"env\":{\"production\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"transform-react-remove-prop-types\",\"lodash\"]},\"test\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"@babel/plugin-transform-modules-commonjs\",[\"module-resolver\",{\"alias\":{\"scripts\":\"./scripts\",\"actions\":\"./scripts/actions\",\"utils\":\"./scripts/utils\",\"reducers\":\"./scripts/reducers\",\"store\":\"./scripts/store\",\"components\":\"./scripts/components\",\"containers\":\"./scripts/containers\",\"constants\":\"./scripts/constants\",\"router\":\"./scripts/router\",\"react-components\":\"./scripts/react-components\",\"named-maps\":\"./scripts/named-maps\"}}]]}},\"babelrc\":false,\"cacheCompression\":false,\"compact\":false}!/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx","dependencies":[{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx","mtime":1543486759544},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/.babelrc","mtime":1548840716937},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nfunction _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n/* eslint-disable camelcase,import/no-extraneous-dependencies */\n\n\nimport { select as d3_select, event as d3_event } from 'd3-selection';\nimport { json as d3_json } from 'd3-request';\nimport { geoPath as d3_geoPath, geoMercator as d3_geoMercator } from 'd3-geo';\nimport { geoRobinson as d3_geoRobinson } from 'd3-geo-projection';\nimport { feature as topojsonFeature } from 'topojson';\nimport isEqual from 'lodash/isEqual';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Responsive from 'react-components/shared/responsive.hoc';\n\nvar Map =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Map, _Component);\n\n  function Map() {\n    _classCallCheck(this, Map);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Map).apply(this, arguments));\n  }\n\n  _createClass(Map, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.build();\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      var cb1 = nextProps.getPolygonClassName,\n          cb2 = nextProps.hideTooltipCallback,\n          cb3 = nextProps.showTooltipCallback,\n          next = _objectWithoutProperties(nextProps, [\"getPolygonClassName\", \"hideTooltipCallback\", \"showTooltipCallback\"]);\n\n      var _this$props = this.props,\n          getPolygonClassName = _this$props.getPolygonClassName,\n          hideTooltipCallback = _this$props.hideTooltipCallback,\n          showTooltipCallback = _this$props.showTooltipCallback,\n          current = _objectWithoutProperties(_this$props, [\"getPolygonClassName\", \"hideTooltipCallback\", \"showTooltipCallback\"]);\n\n      return !isEqual(next, current);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.build();\n    }\n  }, {\n    key: \"getFeaturesBox\",\n    value: function getFeaturesBox(featureBounds) {\n      return {\n        x: featureBounds[0][0],\n        y: featureBounds[0][1],\n        width: featureBounds[1][0] - featureBounds[0][0],\n        height: featureBounds[1][1] - featureBounds[0][1]\n      };\n    } // fits the geometry layer inside the viewport\n\n  }, {\n    key: \"fitGeoInside\",\n    value: function fitGeoInside(featureBounds, width, height) {\n      var bbox = this.getFeaturesBox(featureBounds);\n      var scale = 1 / Math.max(bbox.width / width, bbox.height / height);\n      var trans = [-((bbox.x + bbox.width / 2) * scale) + width / 2, -((bbox.y + bbox.height / 2) * scale) + height / 2];\n      return {\n        scale: scale,\n        trans: trans\n      };\n    }\n  }, {\n    key: \"build\",\n    value: function build() {\n      var _this = this;\n\n      var _this$props2 = this.props,\n          width = _this$props2.width,\n          height = _this$props2.height,\n          testId = _this$props2.testId,\n          topoJSONPath = _this$props2.topoJSONPath,\n          topoJSONRoot = _this$props2.topoJSONRoot,\n          getPolygonTestId = _this$props2.getPolygonTestId,\n          getPolygonClassName = _this$props2.getPolygonClassName,\n          showTooltipCallback = _this$props2.showTooltipCallback,\n          hideTooltipCallback = _this$props2.hideTooltipCallback,\n          useRobinsonProjection = _this$props2.useRobinsonProjection;\n      this.element.innerHTML = '';\n      if (!width || !height) return;\n      var d3Container = d3_select(this.element);\n      var svg = d3Container.append('svg').attr('width', width).attr('height', height);\n      var geoParent = svg.append('g').attr('data-test', testId);\n      var container = geoParent.append('g');\n      var projection = useRobinsonProjection === true ? d3_geoRobinson() : d3_geoMercator();\n      var path = d3_geoPath().projection(projection);\n      d3_json(topoJSONPath, function (error, topoJSON) {\n        if (!topoJSON) return;\n        var features = topojsonFeature(topoJSON, topoJSON.objects[topoJSONRoot]);\n        var polygons = container.selectAll('path').data(features.features).enter().append('path').attr('class', function (d) {\n          return \"polygon \".concat(getPolygonClassName(d));\n        }).attr('data-test', function (d) {\n          return getPolygonTestId && getPolygonTestId(d, testId);\n        }).attr('d', path);\n\n        if (showTooltipCallback !== undefined) {\n          polygons.on('mousemove', function (d) {\n            showTooltipCallback(d, d3_event.clientX + 10, d3_event.clientY + window.scrollY + 10);\n          }).on('mouseout', function () {\n            hideTooltipCallback();\n          });\n        }\n\n        var collection = {\n          type: 'FeatureCollection',\n          features: features.features\n        };\n        var featureBounds = path.bounds(collection);\n\n        var _this$fitGeoInside = _this.fitGeoInside(featureBounds, width, height),\n            scale = _this$fitGeoInside.scale,\n            trans = _this$fitGeoInside.trans;\n\n        container.attr('transform', [\"translate(\".concat(trans, \")\"), \"scale(\".concat(scale, \")\")].join(' '));\n        container.selectAll('path').style('stroke-width', 0.5 / scale);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(\"div\", {\n        ref: function ref(elem) {\n          _this2.element = elem;\n        }\n      });\n    }\n  }]);\n\n  return Map;\n}(Component);\n\nMap.propTypes = {\n  width: PropTypes.number,\n  testId: PropTypes.string,\n  height: PropTypes.number,\n  topoJSONPath: PropTypes.string,\n  topoJSONRoot: PropTypes.string,\n  getPolygonTestId: PropTypes.func,\n  getPolygonClassName: PropTypes.func,\n  showTooltipCallback: PropTypes.func,\n  hideTooltipCallback: PropTypes.func,\n  useRobinsonProjection: PropTypes.bool\n};\n\nvar _default = Responsive({\n  debounceRate: 1000\n})(Map);\n\nexport default _default;\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(_typeof, \"_typeof\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_objectWithoutProperties, \"_objectWithoutProperties\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_objectWithoutPropertiesLoose, \"_objectWithoutPropertiesLoose\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_classCallCheck, \"_classCallCheck\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_defineProperties, \"_defineProperties\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_createClass, \"_createClass\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_possibleConstructorReturn, \"_possibleConstructorReturn\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_assertThisInitialized, \"_assertThisInitialized\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_getPrototypeOf, \"_getPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_inherits, \"_inherits\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_setPrototypeOf, \"_setPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(Map, \"Map\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  reactHotLoader.register(_default, \"default\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/map.component.jsx"],"names":["select","event","json","geoPath","geoMercator","geoRobinson","feature","Map","Component","nextProps","cb1","cb2","cb3","next","getPolygonClassName","hideTooltipCallback","showTooltipCallback","current","isEqual","featureBounds","x","y","width","height","bbox","scale","Math","trans","testId","topoJSONPath","topoJSONRoot","getPolygonTestId","useRobinsonProjection","d3Container","d3_select","svg","geoParent","container","projection","d3_geoRobinson","d3_geoMercator","path","d3_geoPath","d3_json","features","topojsonFeature","topoJSON","polygons","d3_event","window","collection","type","PropTypes","bool","debounceRate"],"mappings":"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","sourcesContent":["/* eslint-disable camelcase,import/no-extraneous-dependencies */\nimport { select as d3_select, event as d3_event } from 'd3-selection';\nimport { json as d3_json } from 'd3-request';\nimport { geoPath as d3_geoPath, geoMercator as d3_geoMercator } from 'd3-geo';\nimport { geoRobinson as d3_geoRobinson } from 'd3-geo-projection';\nimport { feature as topojsonFeature } from 'topojson';\nimport isEqual from 'lodash/isEqual';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Responsive from 'react-components/shared/responsive.hoc';\n\nclass Map extends Component {\n  componentDidMount() {\n    this.build();\n  }\n\n  shouldComponentUpdate(nextProps) {\n    const {\n      getPolygonClassName: cb1,\n      hideTooltipCallback: cb2,\n      showTooltipCallback: cb3,\n      ...next\n    } = nextProps;\n    const {\n      getPolygonClassName,\n      hideTooltipCallback,\n      showTooltipCallback,\n      ...current\n    } = this.props;\n    return !isEqual(next, current);\n  }\n\n  componentDidUpdate() {\n    this.build();\n  }\n\n  getFeaturesBox(featureBounds) {\n    return {\n      x: featureBounds[0][0],\n      y: featureBounds[0][1],\n      width: featureBounds[1][0] - featureBounds[0][0],\n      height: featureBounds[1][1] - featureBounds[0][1]\n    };\n  }\n\n  // fits the geometry layer inside the viewport\n  fitGeoInside(featureBounds, width, height) {\n    const bbox = this.getFeaturesBox(featureBounds);\n    const scale = 1 / Math.max(bbox.width / width, bbox.height / height);\n    const trans = [\n      -((bbox.x + bbox.width / 2) * scale) + width / 2,\n      -((bbox.y + bbox.height / 2) * scale) + height / 2\n    ];\n\n    return { scale, trans };\n  }\n\n  build() {\n    const {\n      width,\n      height,\n      testId,\n      topoJSONPath,\n      topoJSONRoot,\n      getPolygonTestId,\n      getPolygonClassName,\n      showTooltipCallback,\n      hideTooltipCallback,\n      useRobinsonProjection\n    } = this.props;\n\n    this.element.innerHTML = '';\n\n    if (!width || !height) return;\n\n    const d3Container = d3_select(this.element);\n\n    const svg = d3Container\n      .append('svg')\n      .attr('width', width)\n      .attr('height', height);\n\n    const geoParent = svg.append('g').attr('data-test', testId);\n    const container = geoParent.append('g');\n\n    const projection = useRobinsonProjection === true ? d3_geoRobinson() : d3_geoMercator();\n    const path = d3_geoPath().projection(projection);\n    d3_json(topoJSONPath, (error, topoJSON) => {\n      if (!topoJSON) return;\n      const features = topojsonFeature(topoJSON, topoJSON.objects[topoJSONRoot]);\n\n      const polygons = container\n        .selectAll('path')\n        .data(features.features)\n        .enter()\n        .append('path')\n        .attr('class', d => `polygon ${getPolygonClassName(d)}`)\n        .attr('data-test', d => getPolygonTestId && getPolygonTestId(d, testId))\n        .attr('d', path);\n\n      if (showTooltipCallback !== undefined) {\n        polygons\n          .on('mousemove', d => {\n            showTooltipCallback(d, d3_event.clientX + 10, d3_event.clientY + window.scrollY + 10);\n          })\n          .on('mouseout', () => {\n            hideTooltipCallback();\n          });\n      }\n\n      const collection = {\n        type: 'FeatureCollection',\n        features: features.features\n      };\n      const featureBounds = path.bounds(collection);\n      const { scale, trans } = this.fitGeoInside(featureBounds, width, height);\n\n      container.attr('transform', [`translate(${trans})`, `scale(${scale})`].join(' '));\n\n      container.selectAll('path').style('stroke-width', 0.5 / scale);\n    });\n  }\n\n  render() {\n    return (\n      <div\n        ref={elem => {\n          this.element = elem;\n        }}\n      />\n    );\n  }\n}\n\nMap.propTypes = {\n  width: PropTypes.number,\n  testId: PropTypes.string,\n  height: PropTypes.number,\n  topoJSONPath: PropTypes.string,\n  topoJSONRoot: PropTypes.string,\n  getPolygonTestId: PropTypes.func,\n  getPolygonClassName: PropTypes.func,\n  showTooltipCallback: PropTypes.func,\n  hideTooltipCallback: PropTypes.func,\n  useRobinsonProjection: PropTypes.bool\n};\n\nexport default Responsive({ debounceRate: 1000 })(Map);\n"]}]}