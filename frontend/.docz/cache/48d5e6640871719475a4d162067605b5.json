{"remainingRequest":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js?{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\",[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-preset-docz/dist/index.js\",{\"flow\":true,\"typescript\":false,\"parseProps\":true}]],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/docz-utils/lib/named-asset-import.js\",{\"loaderMap\":{\"svg\":{\"ReactComponent\":\"@svgr/webpack?-prettier,-svgo![path]\"}}}],\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/react-hot-loader/babel.js\"],\"env\":{\"production\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"transform-react-remove-prop-types\",\"lodash\"]},\"test\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"@babel/plugin-transform-modules-commonjs\",[\"module-resolver\",{\"alias\":{\"scripts\":\"./scripts\",\"actions\":\"./scripts/actions\",\"utils\":\"./scripts/utils\",\"reducers\":\"./scripts/reducers\",\"store\":\"./scripts/store\",\"components\":\"./scripts/components\",\"containers\":\"./scripts/containers\",\"constants\":\"./scripts/constants\",\"router\":\"./scripts/router\",\"react-components\":\"./scripts/react-components\",\"named-maps\":\"./scripts/named-maps\"}}]]}},\"babelrc\":false,\"cacheCompression\":false,\"compact\":false}!/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx","dependencies":[{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx","mtime":1548345115492},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/.babelrc","mtime":1548840716937},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nfunction _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n/* eslint-disable camelcase,no-var,vars-on-top,no-shadow */\n\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { select as d3_select, interval as d3_interval, easeLinear } from 'd3';\nimport Responsive from 'react-components/shared/responsive.hoc';\nimport d3_sankey from './sankey';\nimport energy from './energy.json';\nimport 'scripts/react-components/animated-flows/animated-flows.scss';\n\nvar AnimatedFlows =\n/*#__PURE__*/\nfunction (_React$PureComponent) {\n  _inherits(AnimatedFlows, _React$PureComponent);\n\n  function AnimatedFlows() {\n    _classCallCheck(this, AnimatedFlows);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(AnimatedFlows).apply(this, arguments));\n  }\n\n  _createClass(AnimatedFlows, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.build();\n    }\n  }, {\n    key: \"build\",\n    value: function build() {\n      var _this$props = this.props,\n          width = _this$props.width,\n          height = _this$props.height;\n      this.container.innerHTML = '';\n      var svg = d3_select(this.container).append('svg').attr('width', width).attr('height', height).append('g');\n      var sankey = d3_sankey(width).nodeWidth(2).nodePadding(10).size([width, height]);\n      var path = sankey.link();\n      sankey.nodes(energy.nodes).links(energy.links).layout(32);\n\n      function setDash() {\n        var d3this = d3_select(this);\n        var totalLength = d3this.node().getTotalLength();\n        d3this.attr('stroke-dasharray', \"\".concat(totalLength, \" \").concat(totalLength)).attr('stroke-dashoffset', totalLength);\n      }\n\n      var gradientLink = svg.append('g').selectAll('.gradient-link').data(energy.links).enter().append('path').attr('class', 'gradient-link').attr('d', path).style('stroke-width', function (d) {\n        return Math.max(1, d.dy);\n      }).sort(function (a, b) {\n        return b.dy - a.dy;\n      }).each(setDash).style('stroke', function () {\n        var id = 'c-000-to-000';\n\n        if (!svg.select(id).node()) {\n          var gradient = svg.append('defs').append('linearGradient').attr('id', id).attr('x1', '0%').attr('y1', '0%').attr('x2', '100%').attr('y2', '0%').attr('spreadMethod', 'pad');\n          gradient.append('stop').attr('offset', '0%').attr('stop-color', '#000').attr('stop-opacity', 0.1);\n          gradient.append('stop').attr('offset', '100%').attr('stop-color', '#000').attr('stop-opacity', 0.3);\n        }\n\n        return \"url(#\".concat(id, \")\");\n      });\n      svg.append('g').selectAll('.link').data(energy.links).enter().append('path').attr('class', 'link').attr('d', path).style('stroke-width', function (d) {\n        return Math.max(1, d.dy);\n      }).sort(function (a, b) {\n        return b.dy - a.dy;\n      });\n\n      function branchAnimate(nodeData) {\n        var links = svg.selectAll('.gradient-link').filter(function (gradientD) {\n          return nodeData.sourceLinks.indexOf(gradientD) > -1;\n        });\n        var nextLayerNodeData = [];\n        links.each(function (d) {\n          return nextLayerNodeData.push(d.target);\n        });\n        links.style('opacity', null).transition().duration(1500).ease(easeLinear).attr('stroke-dashoffset', 0).on('end', function () {\n          return nextLayerNodeData.forEach(function (d) {\n            return branchAnimate(d);\n          });\n        });\n      }\n\n      var node = svg.append('g').selectAll('.node').data(energy.nodes).enter().append('g').attr('class', 'node').attr('transform', function (d) {\n        return \"translate(\".concat(d.x, \", \").concat(d.y, \")\");\n      });\n\n      function cleanBranches() {\n        // cancel all transitions by making a new one\n        gradientLink.transition();\n        gradientLink.style('opacity', 0).each(function gradientSetDash(d) {\n          setDash.call(this, d);\n        });\n      }\n\n      function animateBranch() {\n        var r = Math.floor(Math.random() * (energy.nodes.length + 1));\n        var node = energy.nodes[r];\n\n        if (node && node.sourceLinks.length > 0 && node.x === 0) {\n          branchAnimate(node);\n        } else {\n          animateBranch();\n        }\n      }\n\n      node.append('rect').attr('height', function (d) {\n        return d.dy;\n      }).attr('width', sankey.nodeWidth()).style('opacity', 0);\n      animateBranch();\n      d3_interval(function () {\n        cleanBranches();\n        animateBranch();\n      }, 10000);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this = this;\n\n      return React.createElement(\"div\", {\n        ref: function ref(_ref) {\n          _this.container = _ref;\n        },\n        className: \"c-animated-flows\"\n      });\n    }\n  }]);\n\n  return AnimatedFlows;\n}(React.PureComponent);\n\nAnimatedFlows.propTypes = {\n  width: PropTypes.number,\n  height: PropTypes.number\n};\n\nvar _default = Responsive({\n  debounceRate: 350\n})(AnimatedFlows);\n\nexport default _default;\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(_typeof, \"_typeof\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(_classCallCheck, \"_classCallCheck\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(_defineProperties, \"_defineProperties\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(_createClass, \"_createClass\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(_possibleConstructorReturn, \"_possibleConstructorReturn\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(_assertThisInitialized, \"_assertThisInitialized\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(_getPrototypeOf, \"_getPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(_inherits, \"_inherits\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(_setPrototypeOf, \"_setPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(AnimatedFlows, \"AnimatedFlows\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  reactHotLoader.register(_default, \"default\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/animated-flows/animated-flows.component.jsx"],"names":["select","interval","AnimatedFlows","React","PureComponent","width","height","svg","d3_select","sankey","d3_sankey","path","energy","d3this","totalLength","gradientLink","Math","d","b","a","id","gradient","links","nodeData","nextLayerNodeData","branchAnimate","node","setDash","r","animateBranch","d3_interval","cleanBranches","PropTypes","number","debounceRate"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;AACA,OAAA,KAAA,MAAA,OAAA;AACA,OAAA,SAAA,MAAA,YAAA;AACA,SAASA,MAAM,IAAf,SAAA,EAA8BC,QAAQ,IAAtC,WAAA,EAAA,UAAA,QAAA,IAAA;AAEA,OAAA,UAAA,MAAA,wCAAA;AACA,OAAA,SAAA,MAAA,UAAA;AACA,OAAA,MAAA,MAAA,eAAA;AAEA,OAAA,6DAAA;;IAEMC,a;;;;;;;;;;;;;yCACiB;AACnB,WAAA,KAAA;AACD;;;4BAEO;AAAA,UAAA,WAAA,GACoB,KADpB,KAAA;AAAA,UACEG,KADF,GAAA,WAAA,CAAA,KAAA;AAAA,UACSC,MADT,GAAA,WAAA,CAAA,MAAA;AAGN,WAAA,SAAA,CAAA,SAAA,GAAA,EAAA;AAEA,UAAMC,GAAG,GAAGC,SAAS,CAAC,KAAVA,SAAS,CAATA,CAAAA,MAAAA,CAAAA,KAAAA,EAAAA,IAAAA,CAAAA,OAAAA,EAAAA,KAAAA,EAAAA,IAAAA,CAAAA,QAAAA,EAAAA,MAAAA,EAAAA,MAAAA,CAAZ,GAAYA,CAAZ;AAMA,UAAMC,MAAM,GAAGC,SAAS,CAATA,KAAS,CAATA,CAAAA,SAAAA,CAAAA,CAAAA,EAAAA,WAAAA,CAAAA,EAAAA,EAAAA,IAAAA,CAGP,CAAA,KAAA,EAHR,MAGQ,CAHOA,CAAf;AAKA,UAAMC,IAAI,GAAGF,MAAM,CAAnB,IAAaA,EAAb;AAEAA,MAAAA,MAAM,CAANA,KAAAA,CACSG,MAAM,CADfH,KAAAA,EAAAA,KAAAA,CAESG,MAAM,CAFfH,KAAAA,EAAAA,MAAAA,CAAAA,EAAAA;;AAKA,eAAA,OAAA,GAAmB;AACjB,YAAMI,MAAM,GAAGL,SAAS,CAAxB,IAAwB,CAAxB;AACA,YAAMM,WAAW,GAAGD,MAAM,CAANA,IAAAA,GAApB,cAAoBA,EAApB;AACAA,QAAAA,MAAM,CAANA,IAAAA,CAAAA,kBAAAA,EAAAA,GAAAA,MAAAA,CAAAA,WAAAA,EAAAA,GAAAA,EAAAA,MAAAA,CAAAA,WAAAA,CAAAA,EAAAA,IAAAA,CAAAA,mBAAAA,EAAAA,WAAAA;AAGD;;AAED,UAAIE,YAAY,GAAG,GAAG,CAAH,MAAA,CAAA,GAAA,EAAA,SAAA,CAAA,gBAAA,EAAA,IAAA,CAGXH,MAAM,CAHK,KAAA,EAAA,KAAA,GAAA,MAAA,CAAA,MAAA,EAAA,IAAA,CAAA,OAAA,EAAA,eAAA,EAAA,IAAA,CAAA,GAAA,EAAA,IAAA,EAAA,KAAA,CAAA,cAAA,EAQM,UAAA,CAAA,EAAC;AAAA,eAAII,IAAI,CAAJA,GAAAA,CAAAA,CAAAA,EAAYC,CAAC,CAAjB,EAAID,CAAJ;AARP,OAAA,EAAA,IAAA,CASX,UAAA,CAAA,EAAA,CAAA,EAAA;AAAA,eAAUE,CAAC,CAADA,EAAAA,GAAOC,CAAC,CAAlB,EAAA;AATW,OAAA,EAAA,IAAA,CAAA,OAAA,EAAA,KAAA,CAAA,QAAA,EAWA,YAAM;AACrB,YAAIC,EAAE,GAAN,cAAA;;AACA,YAAI,CAACb,GAAG,CAAHA,MAAAA,CAAAA,EAAAA,EAAL,IAAKA,EAAL,EAA4B;AAC1B,cAAIc,QAAQ,GAAGd,GAAG,CAAHA,MAAAA,CAAAA,MAAAA,EAAAA,MAAAA,CAAAA,gBAAAA,EAAAA,IAAAA,CAAAA,IAAAA,EAAAA,EAAAA,EAAAA,IAAAA,CAAAA,IAAAA,EAAAA,IAAAA,EAAAA,IAAAA,CAAAA,IAAAA,EAAAA,IAAAA,EAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAAA,EAAAA,IAAAA,CAAAA,IAAAA,EAAAA,IAAAA,EAAAA,IAAAA,CAAAA,cAAAA,EAAf,KAAeA,CAAf;AAUAc,UAAAA,QAAQ,CAARA,MAAAA,CAAAA,MAAAA,EAAAA,IAAAA,CAAAA,QAAAA,EAAAA,IAAAA,EAAAA,IAAAA,CAAAA,YAAAA,EAAAA,MAAAA,EAAAA,IAAAA,CAAAA,cAAAA,EAAAA,GAAAA;AAMAA,UAAAA,QAAQ,CAARA,MAAAA,CAAAA,MAAAA,EAAAA,IAAAA,CAAAA,QAAAA,EAAAA,MAAAA,EAAAA,IAAAA,CAAAA,YAAAA,EAAAA,MAAAA,EAAAA,IAAAA,CAAAA,cAAAA,EAAAA,GAAAA;AAKD;;AACD,eAAA,QAAA,MAAA,CAAA,EAAA,EAAA,GAAA,CAAA;AApCJ,OAAmB,CAAnB;AAuCAd,MAAAA,GAAG,CAAHA,MAAAA,CAAAA,GAAAA,EAAAA,SAAAA,CAAAA,OAAAA,EAAAA,IAAAA,CAGQK,MAAM,CAHdL,KAAAA,EAAAA,KAAAA,GAAAA,MAAAA,CAAAA,MAAAA,EAAAA,IAAAA,CAAAA,OAAAA,EAAAA,MAAAA,EAAAA,IAAAA,CAAAA,GAAAA,EAAAA,IAAAA,EAAAA,KAAAA,CAAAA,cAAAA,EAQyB,UAAA,CAAA,EAAC;AAAA,eAAIS,IAAI,CAAJA,GAAAA,CAAAA,CAAAA,EAAYC,CAAC,CAAjB,EAAID,CAAJ;AAR1BT,OAAAA,EAAAA,IAAAA,CASQ,UAAA,CAAA,EAAA,CAAA,EAAA;AAAA,eAAUW,CAAC,CAADA,EAAAA,GAAOC,CAAC,CAAlB,EAAA;AATRZ,OAAAA;;AAWA,eAAA,aAAA,CAAA,QAAA,EAAiC;AAC/B,YAAIe,KAAK,GAAG,GAAG,CAAH,SAAA,CAAA,gBAAA,EAAA,MAAA,CAEF,UAAA,SAAA,EAAS;AAAA,iBAAIC,QAAQ,CAARA,WAAAA,CAAAA,OAAAA,CAAAA,SAAAA,IAA0C,CAA9C,CAAA;AAFnB,SAAY,CAAZ;AAGA,YAAIC,iBAAiB,GAArB,EAAA;AACAF,QAAAA,KAAK,CAALA,IAAAA,CAAW,UAAA,CAAA,EAAC;AAAA,iBAAIE,iBAAiB,CAAjBA,IAAAA,CAAuBP,CAAC,CAA5B,MAAIO,CAAJ;AAAZF,SAAAA;AAEAA,QAAAA,KAAK,CAALA,KAAAA,CAAAA,SAAAA,EAAAA,IAAAA,EAAAA,UAAAA,GAAAA,QAAAA,CAAAA,IAAAA,EAAAA,IAAAA,CAAAA,UAAAA,EAAAA,IAAAA,CAAAA,mBAAAA,EAAAA,CAAAA,EAAAA,EAAAA,CAAAA,KAAAA,EAMa,YAAA;AAAA,iBAAM,iBAAiB,CAAjB,OAAA,CAA0B,UAAA,CAAA,EAAC;AAAA,mBAAIG,aAAa,CAAjB,CAAiB,CAAjB;AAAjC,WAAM,CAAN;AANbH,SAAAA;AAOD;;AACD,UAAII,IAAI,GAAG,GAAG,CAAH,MAAA,CAAA,GAAA,EAAA,SAAA,CAAA,OAAA,EAAA,IAAA,CAGHd,MAAM,CAHH,KAAA,EAAA,KAAA,GAAA,MAAA,CAAA,GAAA,EAAA,IAAA,CAAA,OAAA,EAAA,MAAA,EAAA,IAAA,CAAA,WAAA,EAOU,UAAA,CAAA,EAAC;AAAA,eAAA,aAAA,MAAA,CAAiBK,CAAC,CAAlB,CAAA,EAAA,IAAA,EAAA,MAAA,CAAyBA,CAAC,CAA1B,CAAA,EAAA,GAAA,CAAA;AAPtB,OAAW,CAAX;;AASA,eAAA,aAAA,GAAyB;AACvB;AACAF,QAAAA,YAAY,CAAZA,UAAAA;AACAA,QAAAA,YAAY,CAAZA,KAAAA,CAAAA,SAAAA,EAAAA,CAAAA,EAAAA,IAAAA,CAAsC,SAAA,eAAA,CAAA,CAAA,EAA4B;AAChEY,UAAAA,OAAO,CAAPA,IAAAA,CAAAA,IAAAA,EAAAA,CAAAA;AADFZ,SAAAA;AAGD;;AAED,eAAA,aAAA,GAAyB;AACvB,YAAMa,CAAC,GAAGZ,IAAI,CAAJA,KAAAA,CAAWA,IAAI,CAAJA,MAAAA,MAAiBJ,MAAM,CAANA,KAAAA,CAAAA,MAAAA,GAAtC,CAAqBI,CAAXA,CAAV;AACA,YAAIU,IAAI,GAAGd,MAAM,CAANA,KAAAA,CAAX,CAAWA,CAAX;;AACA,YAAIc,IAAI,IAAIA,IAAI,CAAJA,WAAAA,CAAAA,MAAAA,GAARA,CAAAA,IAAuCA,IAAI,CAAJA,CAAAA,KAA3C,CAAA,EAAyD;AACvDD,UAAAA,aAAa,CAAbA,IAAa,CAAbA;AADF,SAAA,MAEO;AACLI,UAAAA,aAAa;AACd;AACF;;AAEDH,MAAAA,IAAI,CAAJA,MAAAA,CAAAA,MAAAA,EAAAA,IAAAA,CAAAA,QAAAA,EAEkB,UAAA,CAAA,EAAC;AAAA,eAAIT,CAAC,CAAL,EAAA;AAFnBS,OAAAA,EAAAA,IAAAA,CAAAA,OAAAA,EAGiBjB,MAAM,CAHvBiB,SAGiBjB,EAHjBiB,EAAAA,KAAAA,CAAAA,SAAAA,EAAAA,CAAAA;AAMAG,MAAAA,aAAa;AACbC,MAAAA,WAAW,CAAC,YAAM;AAChBC,QAAAA,aAAa;AACbF,QAAAA,aAAa;AAFJ,OAAA,EAAXC,KAAW,CAAXA;AAID;;;6BAEQ;AAAA,UAAA,KAAA,GAAA,IAAA;;AACP,aACE,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AACE,QAAA,GAAG,EAAE,SAAA,GAAA,CAAA,IAAA,EAAO;AACV,UAAA,KAAI,CAAJ,SAAA,GAAA,IAAA;AAFJ,SAAA;AAIE,QAAA,SAAS,EAAC;AAJZ,OAAA,CADF;AAQD;;;;EAtJyB3B,KAAK,CAACC,a;;AAyJlCF,aAAa,CAAbA,SAAAA,GAA0B;AACxBG,EAAAA,KAAK,EAAE2B,SAAS,CADQ,MAAA;AAExB1B,EAAAA,MAAM,EAAE0B,SAAS,CAACC;AAFM,CAA1B/B;;eAKe,UAAU,CAAC;AAAEgC,EAAAA,YAAY,EAAE;AAAhB,CAAD,CAAV,CAAf,aAAe,C;;AAAf;;;;;;;;;;;;;;;;;;;;;0BA9JMhC,a","sourcesContent":["/* eslint-disable camelcase,no-var,vars-on-top,no-shadow */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { select as d3_select, interval as d3_interval, easeLinear } from 'd3';\n\nimport Responsive from 'react-components/shared/responsive.hoc';\nimport d3_sankey from './sankey';\nimport energy from './energy.json';\n\nimport 'scripts/react-components/animated-flows/animated-flows.scss';\n\nclass AnimatedFlows extends React.PureComponent {\n  componentDidUpdate() {\n    this.build();\n  }\n\n  build() {\n    const { width, height } = this.props;\n\n    this.container.innerHTML = '';\n\n    const svg = d3_select(this.container)\n      .append('svg')\n      .attr('width', width)\n      .attr('height', height)\n      .append('g');\n\n    const sankey = d3_sankey(width)\n      .nodeWidth(2)\n      .nodePadding(10)\n      .size([width, height]);\n\n    const path = sankey.link();\n\n    sankey\n      .nodes(energy.nodes)\n      .links(energy.links)\n      .layout(32);\n\n    function setDash() {\n      const d3this = d3_select(this);\n      const totalLength = d3this.node().getTotalLength();\n      d3this\n        .attr('stroke-dasharray', `${totalLength} ${totalLength}`)\n        .attr('stroke-dashoffset', totalLength);\n    }\n\n    var gradientLink = svg\n      .append('g')\n      .selectAll('.gradient-link')\n      .data(energy.links)\n      .enter()\n      .append('path')\n      .attr('class', 'gradient-link')\n      .attr('d', path)\n      .style('stroke-width', d => Math.max(1, d.dy))\n      .sort((a, b) => b.dy - a.dy)\n      .each(setDash)\n      .style('stroke', () => {\n        var id = 'c-000-to-000';\n        if (!svg.select(id).node()) {\n          var gradient = svg\n            .append('defs')\n            .append('linearGradient')\n            .attr('id', id)\n            .attr('x1', '0%')\n            .attr('y1', '0%')\n            .attr('x2', '100%')\n            .attr('y2', '0%')\n            .attr('spreadMethod', 'pad');\n\n          gradient\n            .append('stop')\n            .attr('offset', '0%')\n            .attr('stop-color', '#000')\n            .attr('stop-opacity', 0.1);\n\n          gradient\n            .append('stop')\n            .attr('offset', '100%')\n            .attr('stop-color', '#000')\n            .attr('stop-opacity', 0.3);\n        }\n        return `url(#${id})`;\n      });\n\n    svg\n      .append('g')\n      .selectAll('.link')\n      .data(energy.links)\n      .enter()\n      .append('path')\n      .attr('class', 'link')\n      .attr('d', path)\n      .style('stroke-width', d => Math.max(1, d.dy))\n      .sort((a, b) => b.dy - a.dy);\n\n    function branchAnimate(nodeData) {\n      var links = svg\n        .selectAll('.gradient-link')\n        .filter(gradientD => nodeData.sourceLinks.indexOf(gradientD) > -1);\n      var nextLayerNodeData = [];\n      links.each(d => nextLayerNodeData.push(d.target));\n\n      links\n        .style('opacity', null)\n        .transition()\n        .duration(1500)\n        .ease(easeLinear)\n        .attr('stroke-dashoffset', 0)\n        .on('end', () => nextLayerNodeData.forEach(d => branchAnimate(d)));\n    }\n    var node = svg\n      .append('g')\n      .selectAll('.node')\n      .data(energy.nodes)\n      .enter()\n      .append('g')\n      .attr('class', 'node')\n      .attr('transform', d => `translate(${d.x}, ${d.y})`);\n\n    function cleanBranches() {\n      // cancel all transitions by making a new one\n      gradientLink.transition();\n      gradientLink.style('opacity', 0).each(function gradientSetDash(d) {\n        setDash.call(this, d);\n      });\n    }\n\n    function animateBranch() {\n      const r = Math.floor(Math.random() * (energy.nodes.length + 1));\n      var node = energy.nodes[r];\n      if (node && node.sourceLinks.length > 0 && node.x === 0) {\n        branchAnimate(node);\n      } else {\n        animateBranch();\n      }\n    }\n\n    node\n      .append('rect')\n      .attr('height', d => d.dy)\n      .attr('width', sankey.nodeWidth())\n      .style('opacity', 0);\n\n    animateBranch();\n    d3_interval(() => {\n      cleanBranches();\n      animateBranch();\n    }, 10000);\n  }\n\n  render() {\n    return (\n      <div\n        ref={ref => {\n          this.container = ref;\n        }}\n        className=\"c-animated-flows\"\n      />\n    );\n  }\n}\n\nAnimatedFlows.propTypes = {\n  width: PropTypes.number,\n  height: PropTypes.number\n};\n\nexport default Responsive({ debounceRate: 350 })(AnimatedFlows);\n"]}]}