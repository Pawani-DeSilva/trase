{"remainingRequest":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js?{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\",[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-preset-docz/dist/index.js\",{\"flow\":true,\"typescript\":false,\"parseProps\":true}]],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/docz-utils/lib/named-asset-import.js\",{\"loaderMap\":{\"svg\":{\"ReactComponent\":\"@svgr/webpack?-prettier,-svgo![path]\"}}}],\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/react-hot-loader/babel.js\"],\"env\":{\"production\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"transform-react-remove-prop-types\",\"lodash\"]},\"test\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"@babel/plugin-transform-modules-commonjs\",[\"module-resolver\",{\"alias\":{\"scripts\":\"./scripts\",\"actions\":\"./scripts/actions\",\"utils\":\"./scripts/utils\",\"reducers\":\"./scripts/reducers\",\"store\":\"./scripts/store\",\"components\":\"./scripts/components\",\"containers\":\"./scripts/containers\",\"constants\":\"./scripts/constants\",\"router\":\"./scripts/router\",\"react-components\":\"./scripts/react-components\",\"named-maps\":\"./scripts/named-maps\"}}]]}},\"babelrc\":false,\"cacheCompression\":false,\"compact\":false}!/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx","dependencies":[{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx","mtime":1548345115592},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/.babelrc","mtime":1548840716937},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nfunction _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n/* eslint-disable jsx-a11y/mouse-events-have-key-events,import/no-extraneous-dependencies */\n\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { interpolateNumber as d3InterpolateNumber } from 'd3-interpolate';\nimport formatValue from '../../../utils/formatValue';\nimport wrapSVGText from '../../../utils/wrapSVGText';\nimport { translateText } from '../../../utils/transifex';\nimport Tooltip from '../../../components/shared/info-tooltip.component';\nimport Responsive from '../../shared/responsive.hoc';\nimport './mini-sankey.scss';\nvar BASE_HEIGHT = 400;\nvar TEXT_WIDTH_PERCENTAGE = 20;\nvar NODE_WIDTH = 10;\nvar NODE_WIDTH_SMALL = 4;\nvar NODE_V_SPACE = 15;\nvar TEXT_LINE_HEIGHT = 16;\nvar MEDIUM_RES = 768;\n\nvar MiniSankey =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(MiniSankey, _Component);\n\n  function MiniSankey() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, MiniSankey);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(MiniSankey)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"getTooltipRef\", function (ref) {\n      _this.tooltip = new Tooltip(ref);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"showTooltipCallback\", function (source, indicator, value, unit, x, y) {\n      if (_this.tooltip) {\n        _this.tooltip.show(x, y, source, [{\n          title: indicator,\n          value: formatValue(value, indicator),\n          unit: unit\n        }]);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"hideTooltipCallback\", function () {\n      return _this.tooltip && _this.tooltip.hide();\n    });\n\n    return _this;\n  }\n\n  _createClass(MiniSankey, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          data = _this$props.data,\n          onLinkClick = _this$props.onLinkClick,\n          targetLink = _this$props.targetLink,\n          width = _this$props.width,\n          year = _this$props.year,\n          targetPayload = _this$props.targetPayload,\n          contextId = _this$props.contextId,\n          testId = _this$props.testId;\n      var totalHeight = data.targetNodes.reduce(function (total, node) {\n        return total + Math.ceil(node.height * BASE_HEIGHT) + NODE_V_SPACE;\n      }, 0);\n      var halfHeight = totalHeight / 2;\n      var halfBasePlusSpace = (BASE_HEIGHT + NODE_V_SPACE) / 2;\n      var halfBase = BASE_HEIGHT / 2;\n      var startY = halfHeight <= halfBasePlusSpace ? halfHeight - halfBase : halfHeight - halfBasePlusSpace;\n      var isSmallResolution = width < MEDIUM_RES;\n      var nodeWidth = isSmallResolution ? NODE_WIDTH_SMALL : NODE_WIDTH;\n      var textMinWidth = isSmallResolution ? 130 : 200;\n      var leftTextRotate = isSmallResolution ? '-90' : '0';\n      var rightTextWidth = Math.max(width * TEXT_WIDTH_PERCENTAGE / 100, textMinWidth);\n      var leftTextWidth = isSmallResolution ? 20 : rightTextWidth;\n      var sankeyWidth = width - (leftTextWidth + rightTextWidth);\n      var sankeyXStart = leftTextWidth;\n      var sankeyXEnd = sankeyXStart + sankeyWidth;\n      var currentStartNodeY = startY;\n      var currentEndNodeY = 0;\n\n      var nodes = _toConsumableArray(data.targetNodes).sort(function (nodeA, nodeB) {\n        return nodeB.height - nodeA.height;\n      }).map(function (node) {\n        var renderedHeight = MiniSankey.roundHeight(node.height);\n        var lines = wrapSVGText(translateText(node.name), Math.max(TEXT_LINE_HEIGHT, renderedHeight), TEXT_LINE_HEIGHT, isSmallResolution ? 11 : 18, 3);\n        var percent = 100 * node.height;\n        var n = {\n          id: node.id,\n          name: node.name,\n          isDomesticConsumption: node.is_domestic_consumption,\n          lines: lines,\n          renderedHeight: renderedHeight,\n          pct: \"\".concat(percent * 10 >= 1 ? formatValue(percent, 'percentage') : '< 0.1', \"%\"),\n          sy: currentStartNodeY,\n          ty: currentEndNodeY,\n          value: node.value\n        };\n        currentStartNodeY += n.renderedHeight;\n        currentEndNodeY += n.renderedHeight + NODE_V_SPACE;\n        return n;\n      });\n\n      return React.createElement(\"div\", {\n        className: \"mini-sankey\",\n        \"data-test\": testId\n      }, React.createElement(\"div\", {\n        className: \"c-info-tooltip is-hidden\",\n        ref: this.getTooltipRef\n      }), React.createElement(\"svg\", {\n        style: {\n          height: totalHeight,\n          width: width\n        }\n      }, React.createElement(\"linearGradient\", {\n        id: \"gradient\",\n        x1: \"0\",\n        x2: \"1\",\n        y1: \"0\",\n        y2: \"0\"\n      }, React.createElement(\"stop\", {\n        offset: \"0%\",\n        className: \"gradient-color-start\"\n      }), React.createElement(\"stop\", {\n        offset: \"100%\",\n        className: \"gradient-color-end\"\n      })), React.createElement(\"g\", {\n        transform: \"translate(\".concat(sankeyXStart, \", \").concat(startY, \")\")\n      }, React.createElement(\"rect\", {\n        width: nodeWidth,\n        height: BASE_HEIGHT,\n        className: \"start\"\n      }), React.createElement(\"text\", {\n        className: \"start\",\n        transform: \"translate(-10, \".concat(5 + BASE_HEIGHT / 2, \") rotate(\").concat(leftTextRotate, \")\")\n      }, data.name)), React.createElement(\"g\", {\n        transform: \"translate(\".concat(sankeyXEnd, \", 0)\")\n      }, nodes.map(function (node, index) {\n        return React.createElement(\"g\", {\n          key: index,\n          transform: \"translate(0, \".concat(node.ty, \")\"),\n          className: !node.isDomesticConsumption && targetLink ? 'interactive-node' : null,\n          onClick: function onClick() {\n            if (node.isDomesticConsumption || !targetLink) return;\n            onLinkClick(targetLink, _objectSpread({}, targetPayload || {}, {\n              query: {\n                year: year,\n                contextId: contextId,\n                nodeId: node.id\n              }\n            }));\n          }\n        }, React.createElement(\"rect\", {\n          width: nodeWidth,\n          height: node.renderedHeight,\n          className: \"end\"\n        }), React.createElement(\"text\", {\n          className: \"end\",\n          transform: \"translate(\".concat(nodeWidth + 10, \",\\n                \").concat(13 + node.renderedHeight / 2 - TEXT_LINE_HEIGHT * node.lines.length / 2, \")\")\n        }, node.lines.map(function (line, i) {\n          return React.createElement(\"tspan\", {\n            key: i,\n            y: i * TEXT_LINE_HEIGHT,\n            x: \"0\"\n          }, line, ' ');\n        }), React.createElement(\"tspan\", {\n          className: \"pct\"\n        }, node.pct)));\n      })), React.createElement(\"g\", {\n        transform: \"translate(\".concat(sankeyXStart, \", 0)\")\n      }, nodes.map(function (node, index) {\n        var x0 = nodeWidth;\n        var x1 = sankeyXEnd - sankeyXStart;\n        var xi = d3InterpolateNumber(x0, x1);\n        var x2 = xi(0.6);\n        var x3 = xi(0.4);\n        var y0 = node.sy + node.renderedHeight / 2;\n        var y1 = node.ty + node.renderedHeight / 2;\n        var path = \"M\".concat(x0, \",\").concat(y0, \"C\").concat(x2, \",\").concat(y0, \" \").concat(x3, \",\").concat(y1, \" \").concat(x1, \",\").concat(y1);\n        return React.createElement(\"path\", {\n          key: index,\n          d: path,\n          strokeWidth: node.renderedHeight,\n          \"data-test\": \"\".concat(testId, \"-flow\"),\n          className: node.isAggregated ? 'link-aggr' : 'link',\n          onMouseLeave: _this2.hideTooltipCallback,\n          onMouseMove: function onMouseMove(event) {\n            return _this2.showTooltipCallback(node.name, data.indicator, node.value, data.unit, event.clientX + 10, event.clientY + window.scrollY + 10);\n          }\n        });\n      }))));\n    }\n  }], [{\n    key: \"roundHeight\",\n    value: function roundHeight(height) {\n      var h = BASE_HEIGHT * height;\n      if (h > 1 || parseInt(h * 10, 10) <= 1) return h;\n      return Math.ceil(h);\n    }\n  }]);\n\n  return MiniSankey;\n}(Component);\n\nMiniSankey.propTypes = {\n  data: PropTypes.object,\n  testId: PropTypes.string,\n  onLinkClick: PropTypes.func,\n  targetLink: PropTypes.string,\n  targetPayload: PropTypes.object,\n  width: PropTypes.number,\n  year: PropTypes.number,\n  contextId: PropTypes.number\n};\n\nvar _default = Responsive()(MiniSankey);\n\nexport default _default;\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(_typeof, \"_typeof\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_objectSpread, \"_objectSpread\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_toConsumableArray, \"_toConsumableArray\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_nonIterableSpread, \"_nonIterableSpread\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_iterableToArray, \"_iterableToArray\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_arrayWithoutHoles, \"_arrayWithoutHoles\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_classCallCheck, \"_classCallCheck\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_defineProperties, \"_defineProperties\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_createClass, \"_createClass\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_possibleConstructorReturn, \"_possibleConstructorReturn\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_getPrototypeOf, \"_getPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_inherits, \"_inherits\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_setPrototypeOf, \"_setPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_assertThisInitialized, \"_assertThisInitialized\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_defineProperty, \"_defineProperty\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(BASE_HEIGHT, \"BASE_HEIGHT\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(TEXT_WIDTH_PERCENTAGE, \"TEXT_WIDTH_PERCENTAGE\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(NODE_WIDTH, \"NODE_WIDTH\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(NODE_WIDTH_SMALL, \"NODE_WIDTH_SMALL\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(NODE_V_SPACE, \"NODE_V_SPACE\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(TEXT_LINE_HEIGHT, \"TEXT_LINE_HEIGHT\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(MEDIUM_RES, \"MEDIUM_RES\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(MiniSankey, \"MiniSankey\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  reactHotLoader.register(_default, \"default\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/profiles/mini-sankey/mini-sankey.component.jsx"],"names":["interpolateNumber","BASE_HEIGHT","TEXT_WIDTH_PERCENTAGE","NODE_WIDTH","NODE_WIDTH_SMALL","NODE_V_SPACE","TEXT_LINE_HEIGHT","MEDIUM_RES","MiniSankey","Component","height","h","parseInt","Math","title","value","formatValue","unit","data","onLinkClick","targetLink","width","year","targetPayload","contextId","testId","totalHeight","total","node","halfHeight","halfBasePlusSpace","halfBase","startY","isSmallResolution","nodeWidth","textMinWidth","leftTextRotate","rightTextWidth","leftTextWidth","sankeyWidth","sankeyXStart","sankeyXEnd","currentStartNodeY","currentEndNodeY","nodes","nodeB","nodeA","renderedHeight","lines","wrapSVGText","translateText","percent","n","id","name","isDomesticConsumption","pct","sy","ty","getTooltipRef","query","nodeId","i","x0","x1","xi","d3InterpolateNumber","x2","x3","y0","y1","path","event","window","PropTypes","number","Responsive"],"mappings":"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","sourcesContent":["/* eslint-disable jsx-a11y/mouse-events-have-key-events,import/no-extraneous-dependencies */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { interpolateNumber as d3InterpolateNumber } from 'd3-interpolate';\n\nimport formatValue from '../../../utils/formatValue';\nimport wrapSVGText from '../../../utils/wrapSVGText';\nimport { translateText } from '../../../utils/transifex';\nimport Tooltip from '../../../components/shared/info-tooltip.component';\nimport Responsive from '../../shared/responsive.hoc';\n\nimport './mini-sankey.scss';\n\nconst BASE_HEIGHT = 400;\nconst TEXT_WIDTH_PERCENTAGE = 20;\nconst NODE_WIDTH = 10;\nconst NODE_WIDTH_SMALL = 4;\nconst NODE_V_SPACE = 15;\nconst TEXT_LINE_HEIGHT = 16;\nconst MEDIUM_RES = 768;\n\nclass MiniSankey extends Component {\n  static roundHeight(height) {\n    const h = BASE_HEIGHT * height;\n    if (h > 1 || parseInt(h * 10, 10) <= 1) return h;\n    return Math.ceil(h);\n  }\n\n  getTooltipRef = ref => {\n    this.tooltip = new Tooltip(ref);\n  };\n\n  showTooltipCallback = (source, indicator, value, unit, x, y) => {\n    if (this.tooltip) {\n      this.tooltip.show(x, y, source, [\n        {\n          title: indicator,\n          value: formatValue(value, indicator),\n          unit\n        }\n      ]);\n    }\n  };\n\n  hideTooltipCallback = () => this.tooltip && this.tooltip.hide();\n\n  render() {\n    const {\n      data,\n      onLinkClick,\n      targetLink,\n      width,\n      year,\n      targetPayload,\n      contextId,\n      testId\n    } = this.props;\n    const totalHeight = data.targetNodes.reduce(\n      (total, node) => total + Math.ceil(node.height * BASE_HEIGHT) + NODE_V_SPACE,\n      0\n    );\n\n    const halfHeight = totalHeight / 2;\n    const halfBasePlusSpace = (BASE_HEIGHT + NODE_V_SPACE) / 2;\n    const halfBase = BASE_HEIGHT / 2;\n    const startY =\n      halfHeight <= halfBasePlusSpace ? halfHeight - halfBase : halfHeight - halfBasePlusSpace;\n\n    const isSmallResolution = width < MEDIUM_RES;\n    const nodeWidth = isSmallResolution ? NODE_WIDTH_SMALL : NODE_WIDTH;\n    const textMinWidth = isSmallResolution ? 130 : 200;\n    const leftTextRotate = isSmallResolution ? '-90' : '0';\n    const rightTextWidth = Math.max((width * TEXT_WIDTH_PERCENTAGE) / 100, textMinWidth);\n    const leftTextWidth = isSmallResolution ? 20 : rightTextWidth;\n    const sankeyWidth = width - (leftTextWidth + rightTextWidth);\n    const sankeyXStart = leftTextWidth;\n    const sankeyXEnd = sankeyXStart + sankeyWidth;\n\n    let currentStartNodeY = startY;\n    let currentEndNodeY = 0;\n    const nodes = [...data.targetNodes]\n      .sort((nodeA, nodeB) => nodeB.height - nodeA.height)\n      .map(node => {\n        const renderedHeight = MiniSankey.roundHeight(node.height);\n\n        const lines = wrapSVGText(\n          translateText(node.name),\n          Math.max(TEXT_LINE_HEIGHT, renderedHeight),\n          TEXT_LINE_HEIGHT,\n          isSmallResolution ? 11 : 18,\n          3\n        );\n        const percent = 100 * node.height;\n        const n = {\n          id: node.id,\n          name: node.name,\n          isDomesticConsumption: node.is_domestic_consumption,\n          lines,\n          renderedHeight,\n          pct: `${percent * 10 >= 1 ? formatValue(percent, 'percentage') : '< 0.1'}%`,\n          sy: currentStartNodeY,\n          ty: currentEndNodeY,\n          value: node.value\n        };\n\n        currentStartNodeY += n.renderedHeight;\n        currentEndNodeY += n.renderedHeight + NODE_V_SPACE;\n        return n;\n      });\n\n    return (\n      <div className=\"mini-sankey\" data-test={testId}>\n        <div className=\"c-info-tooltip is-hidden\" ref={this.getTooltipRef} />\n        <svg style={{ height: totalHeight, width }}>\n          <linearGradient id=\"gradient\" x1=\"0\" x2=\"1\" y1=\"0\" y2=\"0\">\n            <stop offset=\"0%\" className=\"gradient-color-start\" />\n            <stop offset=\"100%\" className=\"gradient-color-end\" />\n          </linearGradient>\n\n          <g transform={`translate(${sankeyXStart}, ${startY})`}>\n            <rect width={nodeWidth} height={BASE_HEIGHT} className=\"start\" />\n            <text\n              className=\"start\"\n              transform={`translate(-10, ${5 + BASE_HEIGHT / 2}) rotate(${leftTextRotate})`}\n            >\n              {data.name}\n            </text>\n          </g>\n\n          <g transform={`translate(${sankeyXEnd}, 0)`}>\n            {nodes.map((node, index) => (\n              <g\n                key={index}\n                transform={`translate(0, ${node.ty})`}\n                className={!node.isDomesticConsumption && targetLink ? 'interactive-node' : null}\n                onClick={() => {\n                  if (node.isDomesticConsumption || !targetLink) return;\n                  onLinkClick(targetLink, {\n                    ...(targetPayload || {}),\n                    query: {\n                      year,\n                      contextId,\n                      nodeId: node.id\n                    }\n                  });\n                }}\n              >\n                <rect width={nodeWidth} height={node.renderedHeight} className=\"end\" />\n                <text\n                  className=\"end\"\n                  transform={`translate(${nodeWidth + 10},\n                ${13 + node.renderedHeight / 2 - (TEXT_LINE_HEIGHT * node.lines.length) / 2})`}\n                >\n                  {node.lines.map((line, i) => (\n                    <tspan key={i} y={i * TEXT_LINE_HEIGHT} x=\"0\">\n                      {line}{' '}\n                    </tspan>\n                  ))}\n                  <tspan className=\"pct\">{node.pct}</tspan>\n                </text>\n              </g>\n            ))}\n          </g>\n\n          <g transform={`translate(${sankeyXStart}, 0)`}>\n            {nodes.map((node, index) => {\n              const x0 = nodeWidth;\n              const x1 = sankeyXEnd - sankeyXStart;\n              const xi = d3InterpolateNumber(x0, x1);\n              const x2 = xi(0.6);\n              const x3 = xi(0.4);\n              const y0 = node.sy + node.renderedHeight / 2;\n              const y1 = node.ty + node.renderedHeight / 2;\n              const path = `M${x0},${y0}C${x2},${y0} ${x3},${y1} ${x1},${y1}`;\n\n              return (\n                <path\n                  key={index}\n                  d={path}\n                  strokeWidth={node.renderedHeight}\n                  data-test={`${testId}-flow`}\n                  className={node.isAggregated ? 'link-aggr' : 'link'}\n                  onMouseLeave={this.hideTooltipCallback}\n                  onMouseMove={event =>\n                    this.showTooltipCallback(\n                      node.name,\n                      data.indicator,\n                      node.value,\n                      data.unit,\n                      event.clientX + 10,\n                      event.clientY + window.scrollY + 10\n                    )\n                  }\n                />\n              );\n            })}\n          </g>\n        </svg>\n      </div>\n    );\n  }\n}\n\nMiniSankey.propTypes = {\n  data: PropTypes.object,\n  testId: PropTypes.string,\n  onLinkClick: PropTypes.func,\n  targetLink: PropTypes.string,\n  targetPayload: PropTypes.object,\n  width: PropTypes.number,\n  year: PropTypes.number,\n  contextId: PropTypes.number\n};\n\nexport default Responsive()(MiniSankey);\n"]}]}