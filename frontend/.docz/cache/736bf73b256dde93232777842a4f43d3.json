{"remainingRequest":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js?{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\",[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-preset-docz/dist/index.js\",{\"flow\":true,\"typescript\":false,\"parseProps\":true}]],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/docz-utils/lib/named-asset-import.js\",{\"loaderMap\":{\"svg\":{\"ReactComponent\":\"@svgr/webpack?-prettier,-svgo![path]\"}}}],\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/react-hot-loader/babel.js\"],\"env\":{\"production\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"transform-react-remove-prop-types\",\"lodash\"]},\"test\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"@babel/plugin-transform-modules-commonjs\",[\"module-resolver\",{\"alias\":{\"scripts\":\"./scripts\",\"actions\":\"./scripts/actions\",\"utils\":\"./scripts/utils\",\"reducers\":\"./scripts/reducers\",\"store\":\"./scripts/store\",\"components\":\"./scripts/components\",\"containers\":\"./scripts/containers\",\"constants\":\"./scripts/constants\",\"router\":\"./scripts/router\",\"react-components\":\"./scripts/react-components\",\"named-maps\":\"./scripts/named-maps\"}}]]}},\"babelrc\":false,\"cacheCompression\":false,\"compact\":false}!/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx","dependencies":[{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx","mtime":1548345115647},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/.babelrc","mtime":1548840716937},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nfunction _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n/* eslint-disable jsx-a11y/click-events-have-key-events,jsx-a11y/no-static-element-interactions */\n\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Downshift from 'downshift';\nimport deburr from 'lodash/deburr';\nimport sortBy from 'lodash/sortBy';\nimport NodeTitleGroup from 'react-components/tool/tool-search/node-title-group/node-title-group.container';\nimport SearchResult from 'react-components/tool/tool-search/tool-search-result/tool-search-result.component';\nimport { MAX_SEARCH_RESULTS } from 'constants';\nimport 'scripts/react-components/tool/tool-search/tool-search.scss';\nimport 'scripts/react-components/tool/tool-search/tool-search-result/tool-search-result.scss';\n\nvar ToolSearch =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ToolSearch, _Component);\n\n  _createClass(ToolSearch, null, [{\n    key: \"isValidChar\",\n    value: function isValidChar(key) {\n      var deburredKey = deburr(key);\n      return /^([a-z]|[A-Z]){1}$/.test(deburredKey);\n    }\n  }]);\n\n  function ToolSearch(props) {\n    var _this;\n\n    _classCallCheck(this, ToolSearch);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ToolSearch).call(this, props));\n    _this.state = {\n      charPressedCount: 0\n    };\n    _this.onOpenClicked = _this.onOpenClicked.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onCloseClicked = _this.onCloseClicked.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onSelected = _this.onSelected.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onAddNode = _this.onAddNode.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onKeydown = _this.onKeydown.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onKeyup = _this.onKeyup.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.isNodeSelected = _this.isNodeSelected.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n\n    _this.setDownshiftRef = function (element) {\n      _this.downshift = element;\n    };\n\n    _this.setInputRef = function (element) {\n      _this.input = element;\n    };\n\n    document.addEventListener('keydown', _this.onKeydown);\n    document.addEventListener('keyup', _this.onKeyup);\n    return _this;\n  }\n\n  _createClass(ToolSearch, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.input && !prevProps.isSearchOpen && this.props.isSearchOpen) {\n        this.input.focus();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener('keydown', this.onKeydown);\n      document.removeEventListener('keyup', this.onKeyup);\n    }\n  }, {\n    key: \"onOpenClicked\",\n    value: function onOpenClicked(e) {\n      if (e) e.stopPropagation();\n      this.props.setSankeySearchVisibility(true);\n    }\n  }, {\n    key: \"onCloseClicked\",\n    value: function onCloseClicked(e) {\n      if (e) e.stopPropagation();\n      this.props.setSankeySearchVisibility(false);\n    }\n  }, {\n    key: \"onSelected\",\n    value: function onSelected(selectedItem) {\n      if (!selectedItem) return;\n\n      if (this.isNodeSelected(selectedItem)) {\n        this.downshift.clearSelection();\n        return;\n      }\n\n      var ids = ToolSearch.getNodeIds(selectedItem);\n      this.props.onAddNode(ids);\n      this.onCloseClicked();\n    }\n  }, {\n    key: \"onAddNode\",\n    value: function onAddNode(e, item) {\n      var _this$props = this.props,\n          onAddNode = _this$props.onAddNode,\n          selectedNodesIds = _this$props.selectedNodesIds;\n      if (e) e.stopPropagation();\n      var ids = ToolSearch.getNodeIds(item).filter(function (id) {\n        return !selectedNodesIds.includes(id);\n      });\n      onAddNode(ids);\n      this.downshift.reset();\n      this.input.focus();\n    }\n  }, {\n    key: \"onKeydown\",\n    value: function onKeydown(e) {\n      var isSearchOpen = this.props.isSearchOpen;\n      var charPressedCount = this.state.charPressedCount; // we won't open the search if any combination of keys is pressed\n\n      if (!isSearchOpen && ToolSearch.isValidChar(e.key) && charPressedCount === 0) {\n        this.onOpenClicked();\n      } else if (isSearchOpen && e.key === 'Escape') {\n        this.onCloseClicked();\n      }\n\n      this.setState(function (state) {\n        return {\n          charPressedCount: state.charPressedCount + 1\n        };\n      });\n    }\n  }, {\n    key: \"onKeyup\",\n    value: function onKeyup() {\n      this.setState(function (state) {\n        return {\n          charPressedCount: state.charPressedCount - 1\n        };\n      });\n    }\n  }, {\n    key: \"isNodeSelected\",\n    value: function isNodeSelected(node) {\n      var _this2 = this;\n\n      var ids = ToolSearch.getNodeIds(node);\n      return ids.every(function (id) {\n        return _this2.props.selectedNodesIds.includes(id);\n      });\n    }\n  }, {\n    key: \"getSearchNodes\",\n    value: function getSearchNodes(query) {\n      var _this$props$nodes = this.props.nodes,\n          nodes = _this$props$nodes === void 0 ? [] : _this$props$nodes;\n      return sortBy(nodes.filter(function (i) {\n        if (!query) return true;\n        var item = deburr(i.name.toLowerCase());\n        return item.includes(query.toLowerCase());\n      }), function (item) {\n        return item.name;\n      }).slice(0, MAX_SEARCH_RESULTS);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props2 = this.props,\n          isSearchOpen = _this$props2.isSearchOpen,\n          className = _this$props2.className,\n          _this$props2$selected = _this$props2.selectedNodesIds,\n          selectedNodesIds = _this$props2$selected === void 0 ? [] : _this$props2$selected,\n          isMapVisible = _this$props2.isMapVisible,\n          contextId = _this$props2.contextId,\n          defaultYear = _this$props2.defaultYear;\n\n      if (isSearchOpen === false) {\n        return React.createElement(\"div\", {\n          onClick: this.onOpenClicked,\n          className: className\n        }, React.createElement(\"svg\", {\n          className: \"icon icon-search\"\n        }, React.createElement(\"use\", {\n          xlinkHref: \"#icon-search\"\n        })));\n      }\n\n      return React.createElement(\"div\", {\n        className: \"c-search -tool\"\n      }, React.createElement(\"svg\", {\n        className: \"icon icon-search\"\n      }, React.createElement(\"use\", {\n        xlinkHref: \"#icon-search\"\n      })), React.createElement(\"div\", {\n        className: \"c-search__veil\",\n        onClick: this.onCloseClicked\n      }), React.createElement(\"div\", {\n        className: \"search-wrapper\"\n      }, React.createElement(Downshift, {\n        itemToString: function itemToString(i) {\n          return i === null ? '' : i.name;\n        },\n        onSelect: this.onSelected,\n        ref: this.setDownshiftRef\n      }, function (_ref) {\n        var getInputProps = _ref.getInputProps,\n            getItemProps = _ref.getItemProps,\n            isOpen = _ref.isOpen,\n            inputValue = _ref.inputValue,\n            highlightedIndex = _ref.highlightedIndex;\n        return React.createElement(\"div\", {\n          className: \"search-container\",\n          onClick: function onClick(e) {\n            return e.stopPropagation();\n          }\n        }, React.createElement(\"div\", {\n          className: \"search-bar\"\n        }, React.createElement(\"div\", {\n          style: {\n            overflow: selectedNodesIds.length > 3 ? 'auto' : 'inherit'\n          }\n        }, React.createElement(NodeTitleGroup, null)), React.createElement(\"input\", _extends({}, getInputProps({\n          placeholder: 'Search a producer, trader or country of import'\n        }), {\n          autoComplete: \"off\",\n          ref: _this3.setInputRef,\n          className: \"search-bar-input\",\n          type: \"search\"\n        }))), isOpen && React.createElement(\"ul\", {\n          className: \"search-results\"\n        }, _this3.getSearchNodes(inputValue).map(function (item, row) {\n          return React.createElement(SearchResult, {\n            key: item.id + item.type,\n            value: inputValue,\n            isHighlighted: row === highlightedIndex,\n            isMapVisible: isMapVisible,\n            item: item,\n            contextId: contextId,\n            defaultYear: defaultYear,\n            itemProps: getItemProps({\n              item: item\n            }),\n            selected: _this3.isNodeSelected(item),\n            importerNotSelected: item.importer && !_this3.isNodeSelected(item.importer),\n            exporterNotSelected: item.exporter && !_this3.isNodeSelected(item.exporter),\n            onClickAdd: _this3.onAddNode\n          });\n        })));\n      })));\n    }\n  }], [{\n    key: \"getNodeIds\",\n    value: function getNodeIds(selectedItem) {\n      return selectedItem.id.toString().split('_').map(function (n) {\n        return parseInt(n, 10);\n      });\n    }\n  }]);\n\n  return ToolSearch;\n}(Component);\n\nexport { ToolSearch as default };\nToolSearch.propTypes = {\n  nodes: PropTypes.array,\n  onAddNode: PropTypes.func,\n  contextId: PropTypes.number,\n  className: PropTypes.string,\n  isSearchOpen: PropTypes.bool,\n  isMapVisible: PropTypes.bool,\n  defaultYear: PropTypes.number,\n  selectedNodesIds: PropTypes.array,\n  setSankeySearchVisibility: PropTypes.func\n};\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(_typeof, \"_typeof\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(_extends, \"_extends\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(_classCallCheck, \"_classCallCheck\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(_possibleConstructorReturn, \"_possibleConstructorReturn\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(_getPrototypeOf, \"_getPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(_defineProperties, \"_defineProperties\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(_createClass, \"_createClass\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(_inherits, \"_inherits\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(_setPrototypeOf, \"_setPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(_assertThisInitialized, \"_assertThisInitialized\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  reactHotLoader.register(ToolSearch, \"ToolSearch\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/tool/tool-search/tool-search.component.jsx"],"names":["ToolSearch","Component","key","deburredKey","deburr","charPressedCount","document","prevProps","e","selectedItem","ids","item","onAddNode","selectedNodesIds","isSearchOpen","state","parseInt","node","query","nodes","i","className","isMapVisible","contextId","defaultYear","onCloseClicked","setDownshiftRef","getInputProps","getItemProps","isOpen","inputValue","highlightedIndex","overflow","placeholder","row","PropTypes","setSankeySearchVisibility","func"],"mappings":"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","sourcesContent":["/* eslint-disable jsx-a11y/click-events-have-key-events,jsx-a11y/no-static-element-interactions */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Downshift from 'downshift';\nimport deburr from 'lodash/deburr';\nimport sortBy from 'lodash/sortBy';\nimport NodeTitleGroup from 'react-components/tool/tool-search/node-title-group/node-title-group.container';\nimport SearchResult from 'react-components/tool/tool-search/tool-search-result/tool-search-result.component';\nimport { MAX_SEARCH_RESULTS } from 'constants';\n\nimport 'scripts/react-components/tool/tool-search/tool-search.scss';\nimport 'scripts/react-components/tool/tool-search/tool-search-result/tool-search-result.scss';\n\nexport default class ToolSearch extends Component {\n  static isValidChar(key) {\n    const deburredKey = deburr(key);\n    return /^([a-z]|[A-Z]){1}$/.test(deburredKey);\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = { charPressedCount: 0 };\n    this.onOpenClicked = this.onOpenClicked.bind(this);\n    this.onCloseClicked = this.onCloseClicked.bind(this);\n    this.onSelected = this.onSelected.bind(this);\n    this.onAddNode = this.onAddNode.bind(this);\n    this.onKeydown = this.onKeydown.bind(this);\n    this.onKeyup = this.onKeyup.bind(this);\n    this.isNodeSelected = this.isNodeSelected.bind(this);\n    this.setDownshiftRef = element => {\n      this.downshift = element;\n    };\n    this.setInputRef = element => {\n      this.input = element;\n    };\n\n    document.addEventListener('keydown', this.onKeydown);\n    document.addEventListener('keyup', this.onKeyup);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.input && !prevProps.isSearchOpen && this.props.isSearchOpen) {\n      this.input.focus();\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.onKeydown);\n    document.removeEventListener('keyup', this.onKeyup);\n  }\n\n  onOpenClicked(e) {\n    if (e) e.stopPropagation();\n    this.props.setSankeySearchVisibility(true);\n  }\n\n  onCloseClicked(e) {\n    if (e) e.stopPropagation();\n    this.props.setSankeySearchVisibility(false);\n  }\n\n  onSelected(selectedItem) {\n    if (!selectedItem) return;\n\n    if (this.isNodeSelected(selectedItem)) {\n      this.downshift.clearSelection();\n      return;\n    }\n\n    const ids = ToolSearch.getNodeIds(selectedItem);\n    this.props.onAddNode(ids);\n    this.onCloseClicked();\n  }\n\n  onAddNode(e, item) {\n    const { onAddNode, selectedNodesIds } = this.props;\n    if (e) e.stopPropagation();\n    const ids = ToolSearch.getNodeIds(item).filter(id => !selectedNodesIds.includes(id));\n    onAddNode(ids);\n    this.downshift.reset();\n    this.input.focus();\n  }\n\n  onKeydown(e) {\n    const { isSearchOpen } = this.props;\n    const { charPressedCount } = this.state;\n\n    // we won't open the search if any combination of keys is pressed\n    if (!isSearchOpen && ToolSearch.isValidChar(e.key) && charPressedCount === 0) {\n      this.onOpenClicked();\n    } else if (isSearchOpen && e.key === 'Escape') {\n      this.onCloseClicked();\n    }\n\n    this.setState(state => ({ charPressedCount: state.charPressedCount + 1 }));\n  }\n\n  onKeyup() {\n    this.setState(state => ({ charPressedCount: state.charPressedCount - 1 }));\n  }\n\n  static getNodeIds(selectedItem) {\n    return selectedItem.id\n      .toString()\n      .split('_')\n      .map(n => parseInt(n, 10));\n  }\n\n  isNodeSelected(node) {\n    const ids = ToolSearch.getNodeIds(node);\n    return ids.every(id => this.props.selectedNodesIds.includes(id));\n  }\n\n  getSearchNodes(query) {\n    const { nodes = [] } = this.props;\n    return sortBy(\n      nodes.filter(i => {\n        if (!query) return true;\n        const item = deburr(i.name.toLowerCase());\n        return item.includes(query.toLowerCase());\n      }),\n      item => item.name\n    ).slice(0, MAX_SEARCH_RESULTS);\n  }\n\n  render() {\n    const {\n      isSearchOpen,\n      className,\n      selectedNodesIds = [],\n      isMapVisible,\n      contextId,\n      defaultYear\n    } = this.props;\n\n    if (isSearchOpen === false) {\n      return (\n        <div onClick={this.onOpenClicked} className={className}>\n          <svg className=\"icon icon-search\">\n            <use xlinkHref=\"#icon-search\" />\n          </svg>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"c-search -tool\">\n        <svg className=\"icon icon-search\">\n          <use xlinkHref=\"#icon-search\" />\n        </svg>\n        <div className=\"c-search__veil\" onClick={this.onCloseClicked} />\n        <div className=\"search-wrapper\">\n          <Downshift\n            itemToString={i => (i === null ? '' : i.name)}\n            onSelect={this.onSelected}\n            ref={this.setDownshiftRef}\n          >\n            {({ getInputProps, getItemProps, isOpen, inputValue, highlightedIndex }) => (\n              <div className=\"search-container\" onClick={e => e.stopPropagation()}>\n                <div className=\"search-bar\">\n                  <div style={{ overflow: selectedNodesIds.length > 3 ? 'auto' : 'inherit' }}>\n                    <NodeTitleGroup />\n                  </div>\n                  <input\n                    {...getInputProps({\n                      placeholder: 'Search a producer, trader or country of import'\n                    })}\n                    autoComplete=\"off\"\n                    ref={this.setInputRef}\n                    className=\"search-bar-input\"\n                    type=\"search\"\n                  />\n                </div>\n                {isOpen && (\n                  <ul className=\"search-results\">\n                    {this.getSearchNodes(inputValue).map((item, row) => (\n                      <SearchResult\n                        key={item.id + item.type}\n                        value={inputValue}\n                        isHighlighted={row === highlightedIndex}\n                        isMapVisible={isMapVisible}\n                        item={item}\n                        contextId={contextId}\n                        defaultYear={defaultYear}\n                        itemProps={getItemProps({ item })}\n                        selected={this.isNodeSelected(item)}\n                        importerNotSelected={item.importer && !this.isNodeSelected(item.importer)}\n                        exporterNotSelected={item.exporter && !this.isNodeSelected(item.exporter)}\n                        onClickAdd={this.onAddNode}\n                      />\n                    ))}\n                  </ul>\n                )}\n              </div>\n            )}\n          </Downshift>\n        </div>\n      </div>\n    );\n  }\n}\n\nToolSearch.propTypes = {\n  nodes: PropTypes.array,\n  onAddNode: PropTypes.func,\n  contextId: PropTypes.number,\n  className: PropTypes.string,\n  isSearchOpen: PropTypes.bool,\n  isMapVisible: PropTypes.bool,\n  defaultYear: PropTypes.number,\n  selectedNodesIds: PropTypes.array,\n  setSankeySearchVisibility: PropTypes.func\n};\n"]}]}