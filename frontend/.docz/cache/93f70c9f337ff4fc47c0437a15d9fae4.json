{"remainingRequest":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js?{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\",[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-preset-docz/dist/index.js\",{\"flow\":true,\"typescript\":false,\"parseProps\":true}]],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],[\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/docz-utils/lib/named-asset-import.js\",{\"loaderMap\":{\"svg\":{\"ReactComponent\":\"@svgr/webpack?-prettier,-svgo![path]\"}}}],\"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/react-hot-loader/babel.js\"],\"env\":{\"production\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"transform-react-remove-prop-types\",\"lodash\"]},\"test\":{\"presets\":[[\"@babel/env\",{\"useBuiltIns\":\"entry\"}],\"@babel/preset-react\"],\"plugins\":[\"@babel/plugin-syntax-dynamic-import\",\"@babel/plugin-syntax-object-rest-spread\",\"@babel/plugin-transform-exponentiation-operator\",[\"@babel/plugin-proposal-class-properties\",{\"spec\":true}],\"@babel/plugin-transform-modules-commonjs\",[\"module-resolver\",{\"alias\":{\"scripts\":\"./scripts\",\"actions\":\"./scripts/actions\",\"utils\":\"./scripts/utils\",\"reducers\":\"./scripts/reducers\",\"store\":\"./scripts/store\",\"components\":\"./scripts/components\",\"containers\":\"./scripts/containers\",\"constants\":\"./scripts/constants\",\"router\":\"./scripts/router\",\"react-components\":\"./scripts/react-components\",\"named-maps\":\"./scripts/named-maps\"}}]]}},\"babelrc\":false,\"cacheCompression\":false,\"compact\":false}!/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx","dependencies":[{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx","mtime":1548345115521},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/.babelrc","mtime":1548840716937},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nfunction _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport qs from 'qs';\nimport pickBy from 'lodash/pickBy';\nimport sortBy from 'lodash/sortBy';\nimport DashboardWidget from 'react-components/dashboard-element/dashboard-widget/dashboard-widget.component';\nimport DashboardWidgetTooltip from 'react-components/dashboard-element/dashboard-widget/dashboard-widget-tooltip';\nimport Widget from 'react-components/widgets/widget.component';\nimport CHART_CONFIG from 'react-components/dashboard-element/dashboard-widget/dashboard-widget-config';\n\nvar DashboardWidgetContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(DashboardWidgetContainer, _Component);\n\n  function DashboardWidgetContainer() {\n    _classCallCheck(this, DashboardWidgetContainer);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(DashboardWidgetContainer).apply(this, arguments));\n  }\n\n  _createClass(DashboardWidgetContainer, [{\n    key: \"sortByX\",\n    value: function sortByX(data) {\n      return sortBy(data, 'x');\n    }\n  }, {\n    key: \"getConfig\",\n    value: function getConfig(meta, data) {\n      var chartType = this.props.chartType;\n      var defaultConfig = CHART_CONFIG[chartType] || CHART_CONFIG.line;\n      if (!meta) return defaultConfig;\n\n      var config = _objectSpread({}, defaultConfig, {\n        xAxis: defaultConfig.xAxis && _objectSpread({}, defaultConfig.xAxis, {\n          type: meta.x && meta.x.type\n        }),\n        yAxis: defaultConfig.yAxis && _objectSpread({}, defaultConfig.yAxis, {\n          type: meta.y && meta.x.type\n        }),\n        yAxisLabel: {\n          text: meta.yAxis && meta.yAxis.label,\n          suffix: meta.yAxis && meta.yAxis.suffix\n        },\n        yKeys: DashboardWidgetContainer.getYKeys(meta, defaultConfig),\n        colors: DashboardWidgetContainer.getColors(meta, defaultConfig, chartType, data),\n        tooltip: _objectSpread({}, defaultConfig.tooltip, {\n          content: React.createElement(DashboardWidgetTooltip, {\n            meta: meta\n          })\n        })\n      });\n\n      return config;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this = this;\n\n      var _this$props = this.props,\n          url = _this$props.url,\n          title = _this$props.title;\n\n      var _url$split = url.split('?'),\n          _url$split2 = _slicedToArray(_url$split, 2),\n          base = _url$split2[0],\n          search = _url$split2[1]; // eslint-disable-next-line camelcase\n\n\n      var _pickBy = pickBy(qs.parse(search, {\n        arrayLimit: 1000\n      }), function (x) {\n        return x !== '' && x !== null;\n      }),\n          attribute_id = _pickBy.attribute_id,\n          params = _objectWithoutProperties(_pickBy, [\"attribute_id\"]); // <Widget /> caches data by url and each cache entry is cache busted by it's params\n      // if we want to avoid creating infinite cache entries we should limit the entries to the indicators (attribute_id)\n\n\n      var uniqueUrl = \"\".concat(base, \"?\").concat(qs.stringify({\n        attribute_id: attribute_id\n      }, {\n        encodeValuesOnly: true\n      }));\n      return React.createElement(Widget, {\n        raw: [true],\n        query: [uniqueUrl],\n        params: [params]\n      }, function (_ref) {\n        var data = _ref.data,\n            loading = _ref.loading,\n            error = _ref.error,\n            meta = _ref.meta;\n\n        var sortedData = _this.sortByX(data && data[uniqueUrl]);\n\n        return React.createElement(DashboardWidget, {\n          title: title,\n          error: error,\n          loading: loading,\n          data: sortedData,\n          chartConfig: _this.getConfig(meta && meta[uniqueUrl], sortedData),\n          topLegend: meta && meta\n        });\n      });\n    }\n  }], [{\n    key: \"getGroupedY\",\n    value: function getGroupedY(meta) {\n      var xAxis = meta.xAxis,\n          yAxis = meta.yAxis,\n          x = meta.x,\n          groupedY = _objectWithoutProperties(meta, [\"xAxis\", \"yAxis\", \"x\"]);\n\n      return groupedY;\n    }\n  }, {\n    key: \"sortGroupedY\",\n    value: function sortGroupedY(keys) {\n      return sortBy(Object.keys(keys), function (key) {\n        return parseInt(key.substr(1), 10);\n      });\n    }\n  }, {\n    key: \"getYKeys\",\n    value: function getYKeys(meta, _ref2) {\n      var yKeys = _ref2.yKeys,\n          yKeysAttributes = _ref2.yKeysAttributes,\n          colors = _ref2.colors;\n      if (!meta || !yKeys) return yKeys;\n      var groupedY = DashboardWidgetContainer.getGroupedY(meta);\n      return Object.keys(yKeys).reduce(function (yKeysTypesAcc, nextYKeyType) {\n        var yKeyTypeAttributes = yKeysAttributes && yKeysAttributes[nextYKeyType];\n        return _objectSpread({}, yKeysTypesAcc, _defineProperty({}, nextYKeyType, DashboardWidgetContainer.sortGroupedY(groupedY).reduce(function (groupedYKeysAcc, nextGroupedYKey, index) {\n          return _objectSpread({}, groupedYKeysAcc, _defineProperty({}, nextGroupedYKey, _objectSpread({}, yKeyTypeAttributes, {\n            fill: colors && colors[index],\n            stroke: colors && colors[index]\n          })));\n        }, {})));\n      }, {});\n    }\n  }, {\n    key: \"getColors\",\n    value: function getColors(meta, _ref3, chartType, data) {\n      var colors = _ref3.colors;\n      if (!meta) return colors;\n\n      if (chartType !== 'pie') {\n        var groupedY = DashboardWidgetContainer.getGroupedY(meta);\n        return DashboardWidgetContainer.sortGroupedY(groupedY).map(function (key, index) {\n          return {\n            label: groupedY[key].label || meta.yAxis.label,\n            color: colors[index]\n          };\n        });\n      }\n\n      return data.map(function (item, index) {\n        return {\n          label: item.x,\n          color: colors[index]\n        };\n      });\n    }\n  }]);\n\n  return DashboardWidgetContainer;\n}(Component);\n\nDashboardWidgetContainer.propTypes = {\n  url: PropTypes.string,\n  title: PropTypes.string,\n  chartType: PropTypes.string\n};\nvar _default = DashboardWidgetContainer;\nexport default _default;\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(_typeof, \"_typeof\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_objectWithoutProperties, \"_objectWithoutProperties\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_objectWithoutPropertiesLoose, \"_objectWithoutPropertiesLoose\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_slicedToArray, \"_slicedToArray\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_nonIterableRest, \"_nonIterableRest\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_iterableToArrayLimit, \"_iterableToArrayLimit\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_arrayWithHoles, \"_arrayWithHoles\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_objectSpread, \"_objectSpread\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_defineProperty, \"_defineProperty\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_classCallCheck, \"_classCallCheck\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_defineProperties, \"_defineProperties\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_createClass, \"_createClass\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_possibleConstructorReturn, \"_possibleConstructorReturn\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_assertThisInitialized, \"_assertThisInitialized\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_getPrototypeOf, \"_getPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_inherits, \"_inherits\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_setPrototypeOf, \"_setPrototypeOf\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(DashboardWidgetContainer, \"DashboardWidgetContainer\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  reactHotLoader.register(_default, \"default\", \"/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx\");\n  leaveModule(module);\n})();\n\n;",{"version":3,"sources":["/Users/rodrigo/WorkWorkWorkWorkWork/trase/frontend/scripts/react-components/dashboard-element/dashboard-widget/dashboard-widget.container.jsx"],"names":["DashboardWidgetContainer","Component","meta","xAxis","yAxis","x","groupedY","keys","sortBy","Object","parseInt","key","yKeys","yKeysAttributes","colors","yKeyTypeAttributes","fill","stroke","chartType","data","label","color","item","defaultConfig","CHART_CONFIG","config","type","yAxisLabel","text","suffix","tooltip","content","url","title","base","search","attribute_id","params","pickBy","arrayLimit","uniqueUrl","encodeValuesOnly","loading","error","sortedData","PropTypes","string"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport qs from 'qs';\nimport pickBy from 'lodash/pickBy';\nimport sortBy from 'lodash/sortBy';\nimport DashboardWidget from 'react-components/dashboard-element/dashboard-widget/dashboard-widget.component';\nimport DashboardWidgetTooltip from 'react-components/dashboard-element/dashboard-widget/dashboard-widget-tooltip';\nimport Widget from 'react-components/widgets/widget.component';\nimport CHART_CONFIG from 'react-components/dashboard-element/dashboard-widget/dashboard-widget-config';\n\nclass DashboardWidgetContainer extends Component {\n  static getGroupedY(meta) {\n    const { xAxis, yAxis, x, ...groupedY } = meta;\n    return groupedY;\n  }\n\n  static sortGroupedY(keys) {\n    return sortBy(Object.keys(keys), key => parseInt(key.substr(1), 10));\n  }\n\n  static getYKeys(meta, { yKeys, yKeysAttributes, colors }) {\n    if (!meta || !yKeys) return yKeys;\n    const groupedY = DashboardWidgetContainer.getGroupedY(meta);\n    return Object.keys(yKeys).reduce((yKeysTypesAcc, nextYKeyType) => {\n      const yKeyTypeAttributes = yKeysAttributes && yKeysAttributes[nextYKeyType];\n      return {\n        ...yKeysTypesAcc,\n        [nextYKeyType]: DashboardWidgetContainer.sortGroupedY(groupedY).reduce(\n          (groupedYKeysAcc, nextGroupedYKey, index) => ({\n            ...groupedYKeysAcc,\n            [nextGroupedYKey]: {\n              ...yKeyTypeAttributes,\n              fill: colors && colors[index],\n              stroke: colors && colors[index]\n            }\n          }),\n          {}\n        )\n      };\n    }, {});\n  }\n\n  static getColors(meta, { colors }, chartType, data) {\n    if (!meta) return colors;\n    if (chartType !== 'pie') {\n      const groupedY = DashboardWidgetContainer.getGroupedY(meta);\n      return DashboardWidgetContainer.sortGroupedY(groupedY).map((key, index) => ({\n        label: groupedY[key].label || meta.yAxis.label,\n        color: colors[index]\n      }));\n    }\n    return data.map((item, index) => ({\n      label: item.x,\n      color: colors[index]\n    }));\n  }\n\n  sortByX(data) {\n    return sortBy(data, 'x');\n  }\n\n  getConfig(meta, data) {\n    const { chartType } = this.props;\n    const defaultConfig = CHART_CONFIG[chartType] || CHART_CONFIG.line;\n    if (!meta) return defaultConfig;\n    const config = {\n      ...defaultConfig,\n      xAxis: defaultConfig.xAxis && {\n        ...defaultConfig.xAxis,\n        type: meta.x && meta.x.type\n      },\n      yAxis: defaultConfig.yAxis && {\n        ...defaultConfig.yAxis,\n        type: meta.y && meta.x.type\n      },\n      yAxisLabel: {\n        text: meta.yAxis && meta.yAxis.label,\n        suffix: meta.yAxis && meta.yAxis.suffix\n      },\n      yKeys: DashboardWidgetContainer.getYKeys(meta, defaultConfig),\n      colors: DashboardWidgetContainer.getColors(meta, defaultConfig, chartType, data),\n      tooltip: {\n        ...defaultConfig.tooltip,\n        content: <DashboardWidgetTooltip meta={meta} />\n      }\n    };\n    return config;\n  }\n\n  render() {\n    const { url, title } = this.props;\n\n    const [base, search] = url.split('?');\n    // eslint-disable-next-line camelcase\n    const { attribute_id, ...params } = pickBy(\n      qs.parse(search, { arrayLimit: 1000 }),\n      x => x !== '' && x !== null\n    );\n\n    // <Widget /> caches data by url and each cache entry is cache busted by it's params\n    // if we want to avoid creating infinite cache entries we should limit the entries to the indicators (attribute_id)\n    const uniqueUrl = `${base}?${qs.stringify({ attribute_id }, { encodeValuesOnly: true })}`;\n    return (\n      <Widget raw={[true]} query={[uniqueUrl]} params={[params]}>\n        {({ data, loading, error, meta }) => {\n          const sortedData = this.sortByX(data && data[uniqueUrl]);\n          return (\n            <DashboardWidget\n              title={title}\n              error={error}\n              loading={loading}\n              data={sortedData}\n              chartConfig={this.getConfig(meta && meta[uniqueUrl], sortedData)}\n              topLegend={meta && meta}\n            />\n          );\n        }}\n      </Widget>\n    );\n  }\n}\n\nDashboardWidgetContainer.propTypes = {\n  url: PropTypes.string,\n  title: PropTypes.string,\n  chartType: PropTypes.string\n};\n\nexport default DashboardWidgetContainer;\n"]}]}